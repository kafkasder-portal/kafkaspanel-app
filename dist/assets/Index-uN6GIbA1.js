import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as t}from"./react-vendor-DCtPEfzS.js";import{B as s}from"./dashboard-Bum9Xlfr.js";import{a1 as a,l as r,p as n,bj as i,bk as o,J as l,S as c,aX as d,n as m,ab as u,I as x,U as p,b1 as h,ba as g,a as y,X as f,bl as v,i as j,K as w,a$ as _,O as b,k as N,u as S,aT as k,ar as D,a2 as C,Z as z,s as M}from"./auth-ZaPfAXhT.js";import{h as I}from"./utils-vendor-DxpoukG0.js";import{l as O}from"./messages-Dn-JV80C.js";import"./file-vendor-D5NpndWQ.js";import"./state-vendor-rPBjJaR_.js";import"./chart-vendor-BDEFy5qM.js";import"./supabase-vendor-AMUhAiAi.js";import"./donations-o5PE7GOT.js";const E=(e,t)=>{const s=e?.message||`Error in ${t}`;throw a.error(s),new Error(s)},K=()=>[{id:"conv_1",name:"Y√∂netim Kurulu",conversation_type:"group",created_by:"user1",description:"Y√∂netim kurulu i√ß ileti≈üimi",is_archived:!1,last_message_at:new Date(Date.now()-18e5).toISOString(),created_at:new Date(Date.now()-2592e6).toISOString(),updated_at:(new Date).toISOString()},{id:"conv_2",name:"Proje Koordinasyonu",conversation_type:"group",created_by:"user2",description:"Aktif projeler i√ßin koordinasyon",is_archived:!1,last_message_at:new Date(Date.now()-72e5).toISOString(),created_at:new Date(Date.now()-1296e6).toISOString(),updated_at:(new Date).toISOString()},{id:"conv_3",conversation_type:"direct",created_by:"user1",is_archived:!1,last_message_at:new Date(Date.now()-3e5).toISOString(),created_at:new Date(Date.now()-6048e5).toISOString(),updated_at:(new Date).toISOString()}],R=e=>[{id:"msg_1",sender_id:"user1",conversation_id:e,content:"Merhaba, toplantƒ± i√ßin g√ºndem maddelerini g√∂zden ge√ßirelim.",message_type:"text",created_at:new Date(Date.now()-36e5).toISOString(),updated_at:new Date(Date.now()-36e5).toISOString()},{id:"msg_2",sender_id:"user2",conversation_id:e,content:"Evet, b√ºt√ße konularƒ±nƒ± da ekleyelim. Dosyayƒ± payla≈üƒ±yorum.",message_type:"text",created_at:new Date(Date.now()-27e5).toISOString(),updated_at:new Date(Date.now()-27e5).toISOString()},{id:"msg_3",sender_id:"user2",conversation_id:e,content:"budget_2024.pdf",message_type:"file",file_url:"https://example.com/budget_2024.pdf",file_name:"budget_2024.pdf",file_size:245760,created_at:new Date(Date.now()-18e5).toISOString(),updated_at:new Date(Date.now()-18e5).toISOString()},{id:"msg_4",sender_id:"user3",conversation_id:e,content:"Harika! Ben de proje raporlarƒ±nƒ± hazƒ±rladƒ±m. Yarƒ±n sunabilirim.",message_type:"text",reply_to:"msg_2",created_at:new Date(Date.now()-9e5).toISOString(),updated_at:new Date(Date.now()-9e5).toISOString()},{id:"msg_5",sender_id:"user1",conversation_id:e,content:"M√ºkemmel! O zaman yarƒ±n saat 14:00'da ba≈ülayalƒ±m.",message_type:"text",created_at:new Date(Date.now()-3e5).toISOString(),updated_at:new Date(Date.now()-3e5).toISOString()}],$={async getConversations(){try{return K()}catch(e){return E(e,"getConversations"),[]}},async getConversation(e){try{return K().find(t=>t.id===e)||null}catch(t){return E(t,"getConversation"),null}},async createConversation(e){try{const t={id:`conv_${Date.now()}`,name:e.name,conversation_type:e.conversation_type,created_by:"current_user",description:e.description,is_archived:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return e.participants.length>0&&await this.addParticipants(t.id,e.participants),a.success("Konu≈üma olu≈üturuldu"),t}catch(t){throw E(t,"createConversation"),t}},async updateConversation(e,t){try{const s=K().find(t=>t.id===e);if(!s)throw new Error("Konu≈üma bulunamadƒ±");const r={...s,...t,updated_at:(new Date).toISOString()};return a.success("Konu≈üma g√ºncellendi"),r}catch(s){throw E(s,"updateConversation"),s}},async deleteConversation(e){try{a.success("Konu≈üma silindi")}catch(t){throw E(t,"deleteConversation"),t}},async archiveConversation(e){try{a.success("Konu≈üma ar≈üivlendi")}catch(t){throw E(t,"archiveConversation"),t}},async getMessages(e){try{return R(e)}catch(t){return E(t,"getMessages"),[]}},async sendMessage(e){try{const t={id:`msg_${Date.now()}`,sender_id:"current_user",conversation_id:e.conversation_id,content:e.content,message_type:e.message_type||"text",file_url:e.file_url,file_name:e.file_name,file_size:e.file_size,reply_to:e.reply_to,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return await this.updateConversationLastMessage(e.conversation_id),t}catch(t){throw E(t,"sendMessage"),t}},async editMessage(e,t){try{const s=R("conv_1").find(t=>t.id===e);if(!s)throw new Error("Mesaj bulunamadƒ±");const r={...s,content:t,edited_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return a.success("Mesaj d√ºzenlendi"),r}catch(s){throw E(s,"editMessage"),s}},async deleteMessage(e){try{a.success("Mesaj silindi")}catch(t){throw E(t,"deleteMessage"),t}},async markMessageAsRead(e){},async getConversationParticipants(e){try{return(e=>[{id:"part_1",conversation_id:e,user_id:"user1",role:"admin",joined_at:new Date(Date.now()-2592e6).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-6e5).toISOString()},{id:"part_2",conversation_id:e,user_id:"user2",role:"member",joined_at:new Date(Date.now()-216e7).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-12e5).toISOString()},{id:"part_3",conversation_id:e,user_id:"user3",role:"member",joined_at:new Date(Date.now()-1728e6).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-3e5).toISOString()}])(e)}catch(t){return E(t,"getConversationParticipants"),[]}},async addParticipants(e,t){try{const s=t.map(t=>({id:`part_${Date.now()}_${t}`,conversation_id:e,user_id:t,role:"member",joined_at:(new Date).toISOString(),is_muted:!1}));return a.success(`${t.length} katƒ±lƒ±mcƒ± eklendi`),s}catch(s){throw E(s,"addParticipants"),s}},async removeParticipant(e,t){try{a.success("Katƒ±lƒ±mcƒ± √ßƒ±karƒ±ldƒ±")}catch(s){throw E(s,"removeParticipant"),s}},async updateParticipantRole(e,t,s){try{a.success("Katƒ±lƒ±mcƒ± rol√º g√ºncellendi")}catch(r){throw E(r,"updateParticipantRole"),r}},async muteConversation(e,t,s){try{a.success(s?"Konu≈üma sessize alƒ±ndƒ±":"Konu≈üma sessize alma kaldƒ±rƒ±ldƒ±")}catch(r){throw E(r,"muteConversation"),r}},async markConversationAsRead(e){},async addReaction(e,t){try{return{id:`reaction_${Date.now()}`,message_id:e,user_id:"current_user",emoji:t,created_at:(new Date).toISOString()}}catch(s){throw E(s,"addReaction"),s}},async removeReaction(e){},async getMessageReactions(e){try{return[{id:"reaction_1",message_id:e,user_id:"user1",emoji:"üëç",created_at:(new Date).toISOString()},{id:"reaction_2",message_id:e,user_id:"user2",emoji:"‚ù§Ô∏è",created_at:(new Date).toISOString()}]}catch(t){return E(t,"getMessageReactions"),[]}},async searchMessages(e,t){try{return R(t||"conv_1").filter(t=>t.content.toLowerCase().includes(e.toLowerCase()))}catch(s){return E(s,"searchMessages"),[]}},async getNotifications(e){try{return[{id:"notif_1",user_id:e,conversation_id:"conv_1",message_id:"msg_1",type:"new_message",is_read:!1,created_at:new Date(Date.now()-18e5).toISOString()},{id:"notif_2",user_id:e,conversation_id:"conv_2",message_id:"msg_2",type:"mention",is_read:!1,created_at:new Date(Date.now()-36e5).toISOString()}]}catch(t){return E(t,"getNotifications"),[]}},async markNotificationAsRead(e){},subscribeToConversation:(e,t)=>({unsubscribe:()=>{}}),subscribeToNotifications:(e,t)=>({unsubscribe:()=>{}}),async updateConversationLastMessage(e){},async getUnreadCount(e,t){try{return Math.floor(5*Math.random())}catch(s){return 0}}};function P({conversations:a,selectedConversationId:h,onSelectConversation:g,onCreateConversation:y,onSearchConversations:f,onUpdateConversations:v,loading:j=!1,currentUserId:w}){const[_,b]=t.useState(""),[N,S]=t.useState(null),[k,D]=t.useState({}),[C,z]=t.useState(new Set),[M,E]=t.useState("all");t.useEffect(()=>{(async()=>{if(!w)return;const e={};for(const s of a)try{const t=await $.getUnreadCount(s.id,w);e[s.id]=t}catch(t){}D(e)})()},[a,w]),t.useEffect(()=>{z(new Set(["user1","user2","user3"]))},[]),t.useEffect(()=>{const e=()=>S(null);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const K=a.filter(e=>{const t=!_||e.name?.toLowerCase().includes(_.toLowerCase())||e.description?.toLowerCase().includes(_.toLowerCase()),s="all"===M||"unread"===M&&(k[e.id]||0)>0||"groups"===M&&"group"===e.conversation_type||"direct"===M&&"direct"===e.conversation_type;return t&&s&&!e.is_archived}),R=e=>{if(!e)return"";const t=new Date(e),s=((new Date).getTime()-t.getTime())/36e5;return s<1?"≈üimdi":s<24?I(t,"HH:mm"):I(t,s<168?"EEE":"dd/MM",{locale:O})},P=e=>"group"===e.conversation_type?e.name||"ƒ∞simsiz Grup":"Direkt Mesaj",U=t=>t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:P(t),className:"w-12 h-12 rounded-full object-cover"}):e.jsxs("div",{className:"w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white relative",children:["group"===t.conversation_type?e.jsx(p,{className:"h-6 w-6"}):e.jsx(x,{className:"h-6 w-6"}),"direct"===t.conversation_type&&C.has("user1")&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]});return e.jsxs("div",{className:"w-80 border-r bg-card flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Mesajlar"}),y&&e.jsxs(s,{size:"sm",onClick:y,children:[e.jsx(r,{className:"h-4 w-4 mr-2"}),"Yeni"]})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Konu≈üma ara...",value:_,onChange:e=>{return t=e.target.value,b(t),void f?.(t);var t},className:"w-full pl-10 pr-3 py-2 border border-input rounded-md bg-background text-sm"})]}),e.jsx("div",{className:"flex space-x-1 p-1 bg-muted rounded-lg",children:[{id:"all",label:"T√ºm√º",count:a.length},{id:"unread",label:"Okunmayan",count:Object.values(k).reduce((e,t)=>e+(t>0?1:0),0)},{id:"groups",label:"Gruplar",count:a.filter(e=>"group"===e.conversation_type).length},{id:"direct",label:"Direkt",count:a.filter(e=>"direct"===e.conversation_type).length}].map(t=>e.jsxs("button",{onClick:()=>E(t.id),className:"flex-1 text-xs py-1.5 px-2 rounded transition-colors "+(M===t.id?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[t.label,t.count>0&&e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.count,")"]})]},t.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Y√ºkleniyor..."})]}):K.length>0?e.jsx("div",{className:"space-y-1 p-2",children:K.map(t=>{const s=(a=t.id,k[a]||0);var a;return e.jsxs("div",{className:"relative group cursor-pointer rounded-lg p-3 transition-colors "+(h===t.id?"bg-primary/10 border border-primary/20":"hover:bg-muted/50"),onClick:()=>g(t),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[U(t),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"truncate "+(s>0?"font-semibold":"font-medium"),children:P(t)}),"group"===t.conversation_type&&e.jsx(i,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(o,{className:"h-3 w-3 text-muted-foreground opacity-0"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s>0&&e.jsx("span",{className:"bg-primary text-primary-foreground text-xs px-2 py-0.5 rounded-full min-w-[18px] text-center font-medium",children:s>99?"99+":s}),t.last_message_at&&e.jsx("span",{className:"text-xs text-muted-foreground",children:R(t.last_message_at)}),e.jsx("button",{onClick:e=>((e,t)=>{e.stopPropagation(),S(N===t?null:t)})(e,t.id),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-background/50 rounded transition-opacity",children:e.jsx(l,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex items-center justify-between mt-1",children:e.jsx("p",{className:"text-sm truncate "+(s>0?"text-foreground":"text-muted-foreground"),children:t.description||"Hen√ºz mesaj yok"})})]})]}),N===t.id&&e.jsxs("div",{className:"absolute top-12 right-3 bg-background border rounded-lg shadow-lg z-20 min-w-[160px]",children:[e.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-t-lg flex items-center",onClick:()=>(async(e,t)=>{if(w)try{await $.muteConversation(e,w,t),S(null)}catch(s){}})(t.id,!0),children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Sessize Al"]}),"group"===t.conversation_type&&e.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Grup Ayarlarƒ±"]}),e.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",onClick:()=>(async e=>{try{await $.archiveConversation(e),v?.(),S(null)}catch(t){}})(t.id),children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Ar≈üivle"]}),e.jsx("div",{className:"border-t border-muted my-1"}),e.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-b-lg flex items-center text-destructive",onClick:()=>(async e=>{if(window.confirm("Bu konu≈ümayƒ± silmek istediƒüinizden emin misiniz?"))try{await $.deleteConversation(e),v?.(),S(null)}catch(t){}})(t.id),children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"group"===t.conversation_type?"Gruptan Ayrƒ±l":"Konu≈ümayƒ± Sil"]})]})]},t.id)})}):e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:_?e.jsxs("div",{children:[e.jsx(n,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Arama kriterlerine uygun konu≈üma bulunamadƒ±"}),e.jsxs("p",{className:"text-xs mt-1",children:["'",_,"' i√ßin sonu√ß yok"]})]}):"unread"===M?e.jsxs("div",{children:[e.jsx(u,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Okunmamƒ±≈ü mesaj yok"})]}):e.jsxs("div",{children:[e.jsx(x,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Hen√ºz konu≈üma ba≈ülatƒ±lmamƒ±≈ü"}),y&&e.jsx(s,{size:"sm",className:"mt-3",onClick:y,children:"ƒ∞lk konu≈ümayƒ± ba≈ülat"})]})})}),N&&e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{S(null)}})]})}function U({message:s,isCurrentUser:a,onReply:r,onEdit:n,onDelete:i,showSender:o=!0,onFileDownload:c,isEditing:d=!1,onSaveEdit:u,onCancelEdit:x}){const[p,w]=t.useState(!1),[_,b]=t.useState(s.content||""),N=()=>{_.trim()&&u&&u(s.id,_.trim())},S=()=>{b(s.content||""),x?.()};return e.jsxs("div",{className:"flex gap-3 group "+(a?"flex-row-reverse":""),children:[o&&!a&&e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm flex-shrink-0",children:s.sender_id.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 max-w-xs sm:max-w-md "+(a?"flex flex-col items-end":""),children:[o&&!a&&e.jsxs("div",{className:"text-sm text-muted-foreground mb-1",children:["Kullanƒ±cƒ± ",s.sender_id]}),s.reply_to&&e.jsxs("div",{className:"mb-2 p-2 bg-muted/50 border-l-2 border-primary rounded text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Yanƒ±tlanan mesaj"}),e.jsx("div",{className:"truncate",children:"..."})]}),e.jsxs("div",{className:"relative rounded-lg p-3 "+("system"===s.message_type?"bg-muted/30 text-center":a?"bg-primary text-primary-foreground":"bg-card border"),children:[(()=>{if(d&&"text"===s.message_type)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:_,onChange:e=>b(e.target.value),className:"w-full p-2 border rounded resize-none focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&S():(e.preventDefault(),N())}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:N,disabled:!_.trim(),className:"flex items-center gap-1 px-2 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(y,{className:"h-3 w-3"}),"Kaydet"]}),e.jsxs("button",{onClick:S,className:"flex items-center gap-1 px-2 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600",children:[e.jsx(f,{className:"h-3 w-3"}),"ƒ∞ptal"]})]})]});switch(s.message_type){case"file":return e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg bg-muted/50",children:[e.jsx(v,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.file_name}),s.file_size&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[(s.file_size/1024/1024).toFixed(2)," MB"]})]}),s.file_url&&e.jsx("button",{onClick:()=>c?.(s.file_url,s.file_name),className:"p-2 hover:bg-muted rounded-md",children:e.jsx(j,{className:"h-4 w-4"})})]});case"image":return e.jsxs("div",{className:"space-y-2",children:[s.file_url&&e.jsx("img",{src:s.file_url,alt:s.file_name||"Resim",className:"max-w-xs rounded-lg cursor-pointer hover:opacity-90",onClick:()=>window.open(s.file_url,"_blank")}),s.content&&e.jsx("div",{className:"text-sm",children:s.content})]});case"system":return e.jsx("div",{className:"text-sm text-muted-foreground italic",children:s.content});default:return e.jsx("div",{className:"whitespace-pre-wrap break-words",children:s.content})}})(),e.jsxs("div",{className:"text-xs mt-2 "+("system"===s.message_type?"text-muted-foreground":a?"text-primary-foreground/70":"text-muted-foreground"),children:[(e=>{const t=new Date(e),s=new Date;return t.toDateString()===s.toDateString()?I(t,"HH:mm"):I(t,"dd MMM HH:mm",{locale:O})})(s.created_at),s.edited_at&&e.jsx("span",{className:"ml-1",children:"(d√ºzenlendi)"})]}),"system"!==s.message_type&&!d&&e.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>w(!p),className:"p-1 hover:bg-background/20 rounded",children:e.jsx(l,{className:"h-3 w-3"})}),p&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 bg-background border rounded-lg shadow-lg z-10 min-w-[120px]",children:[r&&e.jsxs("button",{onClick:()=>{r(s),w(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-t-lg flex items-center",children:[e.jsx(h,{className:"h-3 w-3 mr-2"}),"Yanƒ±tla"]}),a&&n&&"text"===s.message_type&&e.jsxs("button",{onClick:()=>{n(s),w(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",children:[e.jsx(g,{className:"h-3 w-3 mr-2"}),"D√ºzenle"]}),a&&i&&e.jsxs("button",{onClick:()=>{i(s.id),w(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-b-lg flex items-center text-red-600",children:[e.jsx(m,{className:"h-3 w-3 mr-2"}),"Sil"]})]})]})})]})]}),p&&e.jsx("div",{className:"fixed inset-0 z-5",onClick:()=>w(!1)})]})}function A({onSendMessage:a,onFileUpload:r,replyingTo:n,onCancelReply:i,disabled:o=!1,placeholder:l="Mesajƒ±nƒ±zƒ± yazƒ±n..."}){const[c,d]=t.useState(""),[m,u]=t.useState(!1),[x,p]=t.useState(!1),h=t.useRef(null),g=t.useRef(null),y=async()=>{c.trim()&&!o&&(a(c.trim()),d(""),g.current&&(g.current.style.height="auto"))},v=async e=>{if(r){u(!0);try{const t=await r(e),s=e.type.startsWith("image/")?"image":"file";a(e.type.startsWith("image/")?"":`üìé ${t.name}`,s)}catch(t){}finally{u(!1)}}};return e.jsxs("div",{className:"border-t bg-background p-4",children:[n&&e.jsxs("div",{className:"mb-3 p-3 bg-muted/50 border-l-2 border-primary rounded flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Kullanƒ±cƒ± ",n.sender_id," kullanƒ±cƒ±sƒ±na yanƒ±t veriyor"]}),e.jsx("div",{className:"text-sm truncate mt-1",children:n.content||("file"===n.message_type?`üìé ${n.file_name}`:"Dosya")})]}),i&&e.jsx(s,{size:"sm",variant:"ghost",onClick:i,children:e.jsx(f,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative "+(x?"bg-primary/10 border-primary":""),onDrop:e=>{e.preventDefault(),p(!1);const t=e.dataTransfer.files[0];t&&v(t)},onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:e=>{e.preventDefault(),p(!1)},children:[x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/5 border-2 border-dashed border-primary rounded-lg z-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-8 w-8 mx-auto text-primary mb-2"}),e.jsx("p",{className:"text-primary font-medium",children:"Dosyayƒ± buraya bƒ±rakƒ±n"})]})}),e.jsxs("div",{className:"flex items-end space-x-2",children:[r&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("input",{ref:h,type:"file",onChange:e=>{const t=e.target.files?.[0];t&&v(t)},className:"hidden",accept:"*/*"}),e.jsx(s,{type:"button",size:"sm",variant:"ghost",onClick:()=>h.current?.click(),disabled:o||m,className:"p-2",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx(s,{type:"button",size:"sm",variant:"ghost",onClick:()=>{h.current&&(h.current.accept="image/*",h.current.click())},disabled:o||m,className:"p-2",children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:g,value:c,onChange:e=>{var t;d(e.target.value),(t=e.target).style.height="auto",t.style.height=Math.min(t.scrollHeight,120)+"px"},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},placeholder:m?"Dosya y√ºkleniyor...":l,disabled:o||m,className:"w-full min-h-[40px] max-h-[120px] px-3 py-2 border border-input rounded-md bg-background resize-none focus:ring-2 focus:ring-ring focus:border-transparent",rows:1}),e.jsx(s,{type:"button",size:"sm",variant:"ghost",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1",disabled:o,children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsx(s,{onClick:y,disabled:!c.trim()||o||m,size:"sm",className:"p-2",children:e.jsx(N,{className:"h-4 w-4"})})]}),m&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"Dosya y√ºkleniyor..."]})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Enter ile g√∂nder, Shift+Enter ile yeni satƒ±r"}),r&&e.jsx("span",{className:"ml-2",children:"‚Ä¢ Dosya y√ºklemek i√ßin s√ºr√ºkleyip bƒ±rakabilirsiniz"})]})]})}function H(){const[r,n]=t.useState([]),[i,o]=t.useState(null),[l,c]=t.useState([]),[d,m]=t.useState([]),[u,x]=t.useState(!0),[h,g]=t.useState(!1),[y,f]=t.useState(null),[v,j]=t.useState(null),[w,_]=t.useState(!0),b=t.useRef(null),{user:I}=S(),O=I?.id;t.useEffect(()=>{E()},[!0]),t.useEffect(()=>{i&&(K(i.id),R(i.id),_(!1))},[i]),t.useEffect(()=>{H()},[l]);const E=async()=>{x(!0);try{const e=await $.getConversations();n(e)}catch(e){a.error("Konu≈ümalar y√ºklenirken hata olu≈ütu")}finally{x(!1)}},K=async e=>{g(!0);try{const t=await $.getMessages(e);c(t),await $.markConversationAsRead(e)}catch(t){a.error("Mesajlar y√ºklenirken hata olu≈ütu")}finally{g(!1)}},R=async e=>{try{const t=await $.getConversationParticipants(e);m(t)}catch(t){}},H=()=>{b.current?.scrollIntoView({behavior:"smooth"})},L=async e=>{j(e.id)},T=async(e,t)=>{try{const{error:s}=await M.from("internal_messages").update({content:t,updated_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;c(s=>s.map(s=>s.id===e?{...s,content:t,updated_at:(new Date).toISOString()}:s)),j(null)}catch(s){a.error("Mesaj g√ºncellenirken bir hata olu≈ütu")}},F=()=>{j(null)},Y=async e=>{if(window.confirm("Bu mesajƒ± silmek istediƒüinizden emin misiniz?"))try{await $.deleteMessage(e),c(t=>t.filter(t=>t.id!==e)),a.success("Mesaj silindi")}catch(t){a.error("Mesaj silinirken hata olu≈ütu")}},B=e=>{f(e)};return e.jsxs("div",{className:"h-[calc(100vh-8rem)] flex bg-background",children:[e.jsx("div",{className:(w?"block":"hidden")+" md:block",children:e.jsx(P,{conversations:r,selectedConversationId:i?.id,onSelectConversation:e=>{o(e),c([]),f(null),j(null)},onCreateConversation:()=>{},loading:u,currentUserId:O})}),e.jsx("div",{className:`flex-1 flex flex-col ${w?"hidden":"flex"} md:flex`,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b bg-card flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s,{variant:"ghost",size:"sm",className:"md:hidden",onClick:()=>{_(!0),o(null)},children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white",children:"group"===i.conversation_type?e.jsx(p,{className:"h-5 w-5"}):"U"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i?"group"===i.conversation_type?i.name||"ƒ∞simsiz Grup":"Direkt Mesaj":""}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"group"===i.conversation_type?`${d.filter(e=>!e.left_at).length} katƒ±lƒ±mcƒ±`:"Aktif"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(s,{variant:"ghost",size:"sm",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsx(s,{variant:"ghost",size:"sm",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(s,{variant:"ghost",size:"sm",children:e.jsx(z,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Mesajlar y√ºkleniyor..."})]}):l.length>0?e.jsxs(e.Fragment,{children:[l.map((t,s)=>{const a=t.sender_id===O,r=0===s||l[s-1].sender_id!==t.sender_id||new Date(t.created_at).getTime()-new Date(l[s-1].created_at).getTime()>3e5;return e.jsx(U,{message:t,isCurrentUser:a,showSender:r&&"group"===i.conversation_type,onReply:B,onEdit:L,onDelete:Y,onFileDownload:(e,t)=>{const s=document.createElement("a");s.href=e,s.download=t,s.click()},isEditing:v===t.id,onSaveEdit:T,onCancelEdit:F},t.id)}),e.jsx("div",{ref:b})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(N,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Hen√ºz mesaj yok"}),e.jsx("p",{className:"text-sm",children:"ƒ∞lk mesajƒ± g√∂ndererek konu≈ümayƒ± ba≈ülatƒ±n"})]})}),e.jsx(A,{onSendMessage:async(e,t="text")=>{if(i)try{const s={conversation_id:i.id,content:e,message_type:t,reply_to:y?.id},a=await $.sendMessage(s);c(e=>[...e,a]),f(null),n(e=>e.map(e=>e.id===i.id?{...e,last_message_at:a.created_at}:e))}catch(s){a.error("Mesaj g√∂nderilirken hata olu≈ütu")}},onFileUpload:async e=>{try{const t=10485760,s=["image/jpeg","image/png","image/gif","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e.size>t)throw new Error("Dosya boyutu 10MB'den k√º√ß√ºk olmalƒ±dƒ±r");if(!s.includes(e.type))throw new Error("Desteklenmeyen dosya t√ºr√º");const a=e.name.split(".").pop(),r=`internal-messages/${`${Date.now()}_${Math.random().toString(36).substring(2)}.${a}`}`,{error:n}=await M.storage.from("uploads").upload(r,e);if(n)throw n;const{data:i}=M.storage.from("uploads").getPublicUrl(r);return{url:i.publicUrl,name:e.name,size:e.size,path:r}}catch(t){throw t}},replyingTo:y,onCancelReply:()=>f(null),placeholder:"Mesajƒ±nƒ±zƒ± yazƒ±n..."})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-center bg-muted/20",children:e.jsxs("div",{children:[e.jsx(p,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"Konu≈üma Se√ßin"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Mesajla≈ümaya ba≈ülamak i√ßin soldaki listeden bir konu≈üma se√ßin"})]})})})]})}export{H as default};
