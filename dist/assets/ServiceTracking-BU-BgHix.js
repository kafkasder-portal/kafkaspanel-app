import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as s}from"./react-vendor-DCtPEfzS.js";import{s as a,l as t,U as i,w as l,y as r,x as n,p as d,i as o,ar as c,a0 as m,o as x,E as u,m as p,X as h,d as g}from"./auth-aCCa6xWs.js";import{e as j,D as b}from"./donations-DMDPGCBk.js";import{M as v}from"./messages-BBXjWSN2.js";import{S as y}from"./aid-DeFRiBQl.js";import{u as f,b as k,s as N,e as _}from"./form-vendor-CfNvelWt.js";import{V as w,t as z}from"./meetings-BPsEwMw_.js";import"./state-vendor-rPBjJaR_.js";import"./supabase-vendor-AMUhAiAi.js";import"./file-vendor-D5NpndWQ.js";import"./utils-vendor-DxpoukG0.js";import"./chart-vendor-CNXqmhrW.js";import"./dashboard-xaTgABQW.js";const D=k({beneficiary_id:N().min(1,"İhtiyaç sahibi seçiniz"),service_type:N().min(1,"Hizmet türü seçiniz"),service_category:N().min(1,"Hizmet kategorisi seçiniz"),description:N().min(1,"Açıklama giriniz"),assigned_to:N().optional(),start_date:N().min(1,"Başlangıç tarihi seçiniz"),expected_completion:N().optional(),priority:_(["low","medium","high","urgent"],{message:"Öncelik seçiniz"}),location:N().optional(),contact_person:N().optional(),contact_phone:N().optional(),notes:N().optional()}),S=["Ev Ziyareti","Sağlık Hizmeti","Eğitim Desteği","Hukuki Danışmanlık","Psikolojik Destek","Mesleki Eğitim","İş Bulma Desteği","Ev Onarımı","Temizlik Hizmeti","Ulaşım Desteği","Tercümanlık","Diğer"],H={"Ev Ziyareti":["Durum Tespiti","Takip Ziyareti","Kontrol Ziyareti"],"Sağlık Hizmeti":["Doktor Randevusu","Hastane Sevki","İlaç Desteği","Tıbbi Malzeme"],"Eğitim Desteği":["Okul Kaydı","Ders Desteği","Kırtasiye Yardımı","Okul Servisi"],"Hukuki Danışmanlık":["Hukuki Bilgilendirme","Dava Takibi","Belge Düzenleme"],"Psikolojik Destek":["Bireysel Görüşme","Grup Terapisi","Aile Danışmanlığı"],"Mesleki Eğitim":["Kurs Kaydı","Sertifika Programı","Staj Desteği"],"İş Bulma Desteği":["İş Arama","Mülakat Hazırlığı","CV Hazırlama"],"Ev Onarımı":["Elektrik","Su Tesisatı","Boyama","Genel Onarım"],"Temizlik Hizmeti":["Genel Temizlik","Dezenfeksiyon","Bahçe Bakımı"],"Ulaşım Desteği":["Hastane Ulaşımı","Okul Ulaşımı","Resmi Kurum Ulaşımı"],"Tercümanlık":["Resmi Kurum","Hastane","Okul","Hukuki İşlemler"],"Diğer":["Özel Durum"]},T=[{id:"user1",name:"Ahmet Yılmaz",email:"ahmet@example.com"},{id:"user2",name:"Fatma Demir",email:"fatma@example.com"},{id:"user3",name:"Mehmet Kaya",email:"mehmet@example.com"},{id:"user4",name:"Ayşe Öztürk",email:"ayse@example.com"}];function C(){const[k,N]=s.useState([]),[_,C]=s.useState({totalServices:0,inProgress:0,completed:0,overdue:0}),[A,K]=s.useState(!0),[B,E]=s.useState(""),[O,Y]=s.useState("all"),[L,P]=s.useState("all"),[G,I]=s.useState("all"),[M,R]=s.useState("all"),[U,Z]=s.useState(!1),[$,F]=s.useState(null),[V,q]=s.useState([]),{register:J,handleSubmit:Q,formState:{errors:W},reset:X,watch:ee}=f({resolver:z(D)}),se=ee("service_type");s.useEffect(()=>{ae(),te(),ie()},[]);const ae=async()=>{try{const e=[{id:"1",beneficiary_id:"ben1",service_type:"Ev Ziyareti",service_category:"Durum Tespiti",description:"Ailenin mevcut durumunu tespit etmek için ev ziyareti",assigned_to:"user1",start_date:(new Date).toISOString(),expected_completion:new Date(Date.now()+6048e5).toISOString(),status:"in_progress",priority:"high",location:"Ankara, Çankaya",contact_person:"Ahmet Yılmaz",contact_phone:"0532 123 45 67",progress_percentage:60,notes:"İlk ziyaret tamamlandı, takip ziyareti planlandı",created_at:(new Date).toISOString(),beneficiaries:{name:"Ali",surname:"Veli",phone:"0533 987 65 43",category:"Aile",address:"Ankara, Çankaya"},assigned_user:{name:"Ahmet Yılmaz",email:"ahmet@example.com"}},{id:"2",beneficiary_id:"ben2",service_type:"Sağlık Hizmeti",service_category:"Doktor Randevusu",description:"Kardiyoloji kontrolü için doktor randevusu alınması",assigned_to:"user2",start_date:new Date(Date.now()-1728e5).toISOString(),end_date:(new Date).toISOString(),status:"completed",priority:"medium",location:"Ankara Şehir Hastanesi",contact_person:"Fatma Demir",contact_phone:"0534 567 89 01",progress_percentage:100,notes:"Randevu alındı ve hasta muayene edildi",created_at:new Date(Date.now()-432e6).toISOString(),beneficiaries:{name:"Ayşe",surname:"Kaya",phone:"0535 123 45 67",category:"Yaşlı",address:"Ankara, Keçiören"},assigned_user:{name:"Fatma Demir",email:"fatma@example.com"}}];N(e)}catch(e){w.error("Hizmet takip kayıtları yüklenirken hata oluştu")}finally{K(!1)}},te=async()=>{try{C({totalServices:25,inProgress:8,completed:15,overdue:2})}catch(e){}},ie=async()=>{try{const{data:e,error:s}=await a.from("beneficiaries").select("id, name, surname, category, phone, address").eq("status","active").order("name");if(s)throw s;q(e||[])}catch(e){}},le=s.useMemo(()=>k.filter(e=>{const s=""===B||`${e.beneficiaries?.name} ${e.beneficiaries?.surname}`.toLowerCase().includes(B.toLowerCase())||e.service_type.toLowerCase().includes(B.toLowerCase())||e.description.toLowerCase().includes(B.toLowerCase())||e.location?.toLowerCase().includes(B.toLowerCase()),a="all"===O||e.service_type===O,t="all"===L||e.status===L,i="all"===G||e.priority===G,l="all"===M||e.assigned_to===M;return s&&a&&t&&i&&l}),[k,B,O,L,G,M]),re=s=>{const a={planned:{label:"Planlandı",class:"bg-blue-100 text-blue-800",icon:g},in_progress:{label:"Devam Ediyor",class:"bg-yellow-100 text-yellow-800",icon:l},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:r},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:h},on_hold:{label:"Beklemede",class:"bg-gray-100 text-gray-800",icon:n}}[s]||{label:s,class:"bg-gray-100 text-gray-800",icon:n},t=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:[e.jsx(t,{className:"h-3 w-3"}),a.label]})},ne=e=>new Date(e).toLocaleDateString("tr-TR"),de=e=>!(!e.expected_completion||"completed"===e.status)&&new Date(e.expected_completion)<new Date,oe=[{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(s,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.beneficiaries?.name," ",a.beneficiaries?.surname]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.beneficiaries?.category}),a.beneficiaries?.phone&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(c,{className:"h-3 w-3"}),a.beneficiaries.phone]})]})},{key:"service_info",header:"Hizmet Bilgisi",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.service_type}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.service_category}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 max-w-xs truncate",title:a.description,children:a.description})]})},{key:"assigned_user",header:"Atanan Kişi",render:(s,a)=>e.jsx("div",{children:a.assigned_user?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(m,{className:"h-3 w-3"}),a.assigned_user.name]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.assigned_user.email})]}):e.jsx("span",{className:"text-muted-foreground",children:"Atanmamış"})})},{key:"priority",header:"Öncelik",render:(s,a)=>(s=>{const a={low:{label:"Düşük",class:"bg-gray-100 text-gray-800"},medium:{label:"Orta",class:"bg-blue-100 text-blue-800"},high:{label:"Yüksek",class:"bg-orange-100 text-orange-800"},urgent:{label:"Acil",class:"bg-red-100 text-red-800"}}[s]||{label:s,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:a.label})})(a.priority)},{key:"status",header:"Durum",render:(s,a)=>e.jsxs("div",{children:[re(a.status),"in_progress"===a.status&&e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${a.progress_percentage}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["%",a.progress_percentage]})]})]})},{key:"dates",header:"Tarihler",render:(s,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Başlangıç:"})," ",ne(a.start_date)]}),a.expected_completion&&e.jsxs("div",{className:"text-sm "+(de(a)?"text-red-600 font-medium":"text-muted-foreground"),children:[e.jsx("strong",{children:"Bitiş:"})," ",ne(a.expected_completion),de(a)&&e.jsx("span",{className:"ml-1",children:"(Gecikmiş)"})]}),a.end_date&&e.jsxs("div",{className:"text-sm text-green-600",children:[e.jsx("strong",{children:"Tamamlandı:"})," ",ne(a.end_date)]})]})},{key:"location",header:"Konum",render:(s,a)=>e.jsx("div",{children:a.location?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.location})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"actions",header:"İşlemler",render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(u,{className:"h-4 w-4"})}),"completed"!==a.status&&"cancelled"!==a.status&&e.jsx("button",{onClick:()=>{F(a),Z(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(p,{className:"h-4 w-4"})})]})}];return A?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Hizmet Takip İşlemleri"}),e.jsx("p",{className:"text-muted-foreground",children:"Verilen hizmetleri takip edin ve yönetin"})]}),e.jsxs("button",{onClick:()=>{F(null),Z(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(t,{className:"h-4 w-4"}),"Yeni Hizmet"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(y,{title:"Toplam Hizmetler",value:_.totalServices.toString(),icon:i,accentClass:"bg-blue-100"}),e.jsx(y,{title:"Devam Eden",value:_.inProgress.toString(),icon:l,accentClass:"bg-yellow-100"}),e.jsx(y,{title:"Tamamlanan",value:_.completed.toString(),icon:r,accentClass:"bg-green-100"}),e.jsx(y,{title:"Geciken",value:_.overdue.toString(),icon:n,accentClass:"bg-red-100"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Hizmet ara...",value:B,onChange:e=>E(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:O,onChange:e=>Y(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Hizmet Türleri"}),S.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:L,onChange:e=>P(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"planned",children:"Planlandı"}),e.jsx("option",{value:"in_progress",children:"Devam Ediyor"}),e.jsx("option",{value:"completed",children:"Tamamlandı"}),e.jsx("option",{value:"cancelled",children:"İptal Edildi"}),e.jsx("option",{value:"on_hold",children:"Beklemede"})]}),e.jsxs("select",{value:G,onChange:e=>I(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Öncelikler"}),e.jsx("option",{value:"low",children:"Düşük"}),e.jsx("option",{value:"medium",children:"Orta"}),e.jsx("option",{value:"high",children:"Yüksek"}),e.jsx("option",{value:"urgent",children:"Acil"})]}),e.jsxs("select",{value:M,onChange:e=>R(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Atananlar"}),T.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("button",{onClick:()=>j("hizmet-takip.csv",le),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(o,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[le.length," hizmet"]})]}),e.jsx(b,{columns:oe,data:le}),e.jsxs(v,{open:U,onClose:()=>Z(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:$?"Hizmet Düzenle":"Yeni Hizmet Takibi"}),e.jsx("button",{onClick:()=>Z(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:Q(async e=>{try{const s={id:Date.now().toString(),...e,status:"planned",progress_percentage:0,created_at:(new Date).toISOString(),beneficiaries:V.find(s=>s.id===e.beneficiary_id),assigned_user:T.find(s=>s.id===e.assigned_to)};N(e=>[s,...e]),w.success("Hizmet takip kaydı başarıyla oluşturuldu"),Z(!1),X(),te()}catch(s){w.error("Hizmet takip kaydı oluşturulurken hata oluştu")}}),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İhtiyaç Sahibi *"}),e.jsxs("select",{...J("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),V.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.surname," - ",s.category]},s.id))]}),W.beneficiary_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.beneficiary_id.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Türü *"}),e.jsxs("select",{...J("service_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),S.map(s=>e.jsx("option",{value:s,children:s},s))]}),W.service_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.service_type.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Kategorisi *"}),e.jsxs("select",{...J("service_category"),className:"w-full rounded border px-3 py-2 text-sm",disabled:!se,children:[e.jsx("option",{value:"",children:"Seçiniz..."}),se&&H[se]?.map(s=>e.jsx("option",{value:s,children:s},s))]}),W.service_category&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.service_category.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Öncelik *"}),e.jsxs("select",{...J("priority"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),e.jsx("option",{value:"low",children:"Düşük"}),e.jsx("option",{value:"medium",children:"Orta"}),e.jsx("option",{value:"high",children:"Yüksek"}),e.jsx("option",{value:"urgent",children:"Acil"})]}),W.priority&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.priority.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Açıklama *"}),e.jsx("textarea",{...J("description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet açıklaması..."}),W.description&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Atanan Kişi"}),e.jsxs("select",{...J("assigned_to"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),T.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Konum"}),e.jsx("input",{type:"text",...J("location"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet konumu"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Başlangıç Tarihi *"}),e.jsx("input",{type:"date",...J("start_date"),className:"w-full rounded border px-3 py-2 text-sm"}),W.start_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.start_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beklenen Bitiş Tarihi"}),e.jsx("input",{type:"date",...J("expected_completion"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Kişisi"}),e.jsx("input",{type:"text",...J("contact_person"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İletişim kişisi adı"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Telefonu"}),e.jsx("input",{type:"tel",...J("contact_phone"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0532 123 45 67"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{...J("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet ile ilgili notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(t,{className:"h-4 w-4"}),$?"Güncelle":"Kaydet"]})]})]})]})]})}export{C as default};
