import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as a}from"./react-vendor-DCtPEfzS.js";import{e as t,D as s}from"./donations-DMDPGCBk.js";import{M as l}from"./messages-BBXjWSN2.js";import"./dashboard-xaTgABQW.js";import{M as n,h as r,i,j as o,m as d}from"./chart-vendor-CNXqmhrW.js";import{L as c}from"./LazyQRScannerModal-B4-wsGgm.js";import{g as m,a as x,b as u}from"./qrCodeUtils-EWtYda1B.js";import{Q as h}from"./auth-aCCa6xWs.js";import"./utils-vendor-DxpoukG0.js";import"./file-vendor-D5NpndWQ.js";import"./state-vendor-rPBjJaR_.js";import"./supabase-vendor-AMUhAiAi.js";delete d.Icon.Default.prototype._getIconUrl,d.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const p=({isOpen:t,onClose:s,address:d,bankNumber:c,assignedTo:m})=>{const[x,u]=a.useState(null),[h,p]=a.useState(!1),[g,b]=a.useState(null);return a.useEffect(()=>{t&&d&&(p(!0),b(null),(async e=>{try{const a=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1`),t=await a.json();return t&&t.length>0?{lat:parseFloat(t[0].lat),lng:parseFloat(t[0].lon)}:null}catch(a){return null}})(d).then(e=>{e?u(e):b("Adres bulunamadı")}).catch(()=>{b("Adres aranırken hata oluştu")}).finally(()=>{p(!1)}))},[t,d]),e.jsx(l,{isOpen:t,onClose:s,title:`Harita - ${c}`,size:"large",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Kumbara:"}),e.jsx("span",{className:"ml-2 font-medium",children:c})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Atanan Yer:"}),e.jsx("span",{className:"ml-2 font-medium",children:m})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-600",children:"Adres:"}),e.jsx("span",{className:"ml-2 font-medium",children:d})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>{if(x){const e=`https://www.google.com/maps/dir/?api=1&destination=${x.lat},${x.lng}`;window.open(e,"_blank")}else{const e=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("span",{children:"🗺️"}),"Google Maps'te Rota"]}),e.jsxs("button",{onClick:()=>{if(x){const e=`https://maps.apple.com/?daddr=${x.lat},${x.lng}`;window.open(e,"_blank")}else{const e=`https://maps.apple.com/?daddr=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("span",{children:"🍎"}),"Apple Maps'te Rota"]}),e.jsxs("button",{onClick:()=>{if(x){const e=`https://yandex.com.tr/maps/?rtext=~${x.lat},${x.lng}&rtt=auto`;window.open(e,"_blank")}else{const e=`https://yandex.com.tr/maps/?text=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center gap-2",children:[e.jsx("span",{children:"🔍"}),"Yandex Maps'te Rota"]})]}),e.jsxs("div",{className:"h-96 border rounded-lg overflow-hidden",children:[h&&e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Adres aranıyor..."})]})}),g&&e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:g}),e.jsx("p",{className:"text-sm text-gray-500",children:"Rota butonlarını kullanarak harici harita uygulamalarında açabilirsiniz."})]})}),x&&!h&&!g&&e.jsxs(n,{center:[x.lat,x.lng],zoom:15,style:{height:"100%",width:"100%"},children:[e.jsx(r,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(i,{position:[x.lat,x.lng],children:e.jsx(o,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("strong",{children:c}),e.jsx("br",{}),m,e.jsx("br",{}),e.jsx("small",{children:d})]})})})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 bg-blue-50 p-3 rounded",children:["💡 ",e.jsx("strong",{children:"İpucu:"})," Rota butonlarını kullanarak tercih ettiğiniz harita uygulamasında navigasyon başlatabilirsiniz."]})]})})},g=({isOpen:t,onClose:s,bank:n})=>{const{bankNumber:r,id:i,assignedTo:o,location:d,qrCode:c}=n||{},[u,h]=a.useState(null),[p,g]=a.useState(!1),[b,j]=a.useState(null),y=a.useCallback(async()=>{if(r&&i){g(!0),j(null);try{if(c)h(c);else{const e=m({bankNumber:r,assignedTo:o||"",location:d||"",contactPerson:"",contactPhone:""});h(e)}}catch(e){j("QR kod oluşturulamadı")}finally{g(!1)}}},[r,i,c,o,d]);return a.useEffect(()=>{t&&r&&i&&y()},[t,r,i,y]),e.jsx(l,{isOpen:t,onClose:s,title:`QR Kod - ${r}`,size:"medium",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Kumbara:"}),e.jsx("span",{className:"ml-2 font-medium",children:r})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Atanan Yer:"}),e.jsx("span",{className:"ml-2 font-medium",children:o})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-600",children:"Lokasyon:"}),e.jsx("span",{className:"ml-2 font-medium",children:d})]})]})}),e.jsxs("div",{className:"text-center",children:[p&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"QR kod oluşturuluyor..."})]})}),b&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-4xl mb-2",children:"⚠️"}),e.jsx("p",{className:"text-red-600",children:b}),e.jsx("button",{onClick:y,className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Tekrar Dene"})]})}),u&&!p&&!b&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"border-2 border-gray-200 p-4 rounded-lg bg-white",children:e.jsx("img",{src:u,alt:`QR Kod - ${r}`,className:"w-64 h-64 object-contain"})})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Bu QR kodu tarayarak kumbara bilgilerine ulaşabilirsiniz."}),e.jsxs("p",{className:"mt-1",children:["Kumbara ID: ",e.jsx("span",{className:"font-mono",children:i})]})]})]})]}),u&&!p&&!b&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{if(!u)return;const e=document.createElement("a");e.download=`${r}-qr-kod.png`,e.href=u,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"💾"}),"İndir"]}),e.jsxs("button",{onClick:()=>{if(!u)return;const e=x(u,r),a=window.open("","_blank");a&&(a.document.write(e),a.document.close(),a.onload=()=>{a.print(),a.close()})},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"🖨️"}),"Yazdır"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:async()=>{if(u)try{const e=await fetch(u),a=await e.blob();await navigator.clipboard.write([new ClipboardItem({"image/png":a})]),alert("QR kod panoya kopyalandı!")}catch(e){alert("QR kod panoya kopyalanamadı")}},className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 flex items-center justify-center gap-2 text-sm",children:[e.jsx("span",{children:"📋"}),"Resmi Kopyala"]}),e.jsxs("button",{onClick:()=>{const e=JSON.stringify({type:"piggy_bank",bankNumber:r,bankId:i,timestamp:(new Date).toISOString()});navigator.clipboard.writeText(e).then(()=>{alert("QR kod verisi panoya kopyalandı!")}).catch(()=>{alert("QR kod verisi panoya kopyalanamadı")})},className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 flex items-center justify-center gap-2 text-sm",children:[e.jsx("span",{children:"📄"}),"Veriyi Kopyala"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 bg-blue-50 p-3 rounded",children:["💡 ",e.jsx("strong",{children:"Kullanım:"}),e.jsxs("ul",{className:"mt-1 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"İndir:"})," QR kodu PNG dosyası olarak kaydedin"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Yazdır:"})," QR kodu etiket olarak yazdırın"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resmi Kopyala:"})," QR kod görüntüsünü panoya kopyalayın"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Veriyi Kopyala:"})," QR kod içeriğini metin olarak kopyalayın"]})]})]})]})})},b=[{id:"1",bankNumber:"KB-2024-001",assignedTo:"Ahmet Market",assignedDate:"2024-01-15",location:"Fatih/İstanbul",locationDetails:"Ahmet Market - Kasa yanı",address:"Fatih Mahallesi, Atatürk Caddesi No:15, Fatih/İstanbul",contactPerson:"Ahmet Yılmaz",contactPhone:"+90 532 123 4567",contactEmail:"ahmet@market.com",initialAmount:0,currentAmount:1250,lastCollectionDate:"2024-11-15",lastCollectionAmount:850,totalCollected:3400,collectionCount:4,averageCollection:850,status:"aktif",bankType:"standart",material:"plastik",capacity:2e3,weight:1.2,qrCode:"KB001QR",notes:"Düzenli toplama yapılıyor",assignedBy:"Admin",createdDate:"2024-01-15",lastModified:"2024-11-15",modifiedBy:"Collector1"},{id:"2",bankNumber:"KB-2024-002",assignedTo:"Merkez Cami",assignedDate:"2024-02-01",location:"Üsküdar/İstanbul",locationDetails:"Merkez Cami - Giriş holü",address:"Merkez Mahallesi, Cami Sokak No:5, Üsküdar/İstanbul",contactPerson:"İmam Mehmet Bey",contactPhone:"+90 533 987 6543",initialAmount:0,currentAmount:1950,lastCollectionDate:"2024-11-10",lastCollectionAmount:1200,totalCollected:5600,collectionCount:5,averageCollection:1120,status:"dolu",bankType:"büyük",material:"metal",capacity:2e3,weight:2.1,qrCode:"KB002QR",notes:"Cuma namazı sonrası yoğun bağış",assignedBy:"Admin",createdDate:"2024-02-01",lastModified:"2024-11-10",modifiedBy:"Collector2"},{id:"3",bankNumber:"KB-2024-003",assignedTo:"Özel Okul",assignedDate:"2024-03-10",location:"Kadıköy/İstanbul",locationDetails:"Özel Okul - Öğretmenler odası",address:"Eğitim Mahallesi, Okul Caddesi No:25, Kadıköy/İstanbul",contactPerson:"Zeynep Öğretmen",contactPhone:"+90 534 111 2233",contactEmail:"zeynep@okul.edu.tr",initialAmount:0,currentAmount:0,lastCollectionDate:"2024-11-20",lastCollectionAmount:650,totalCollected:2100,collectionCount:3,averageCollection:700,status:"bakımda",bankType:"özel",material:"plastik",capacity:1500,weight:.8,qrCode:"KB003QR",notes:"Kilit arızası - tamir edilecek",assignedBy:"Admin",createdDate:"2024-03-10",lastModified:"2024-11-20",modifiedBy:"Maintenance"},{id:"4",bankNumber:"KB-2024-004",assignedTo:"Hastane Kantini",assignedDate:"2024-04-05",location:"Şişli/İstanbul",locationDetails:"Hastane Kantini - Kasa üstü",address:"Sağlık Mahallesi, Hastane Caddesi No:10, Şişli/İstanbul",contactPerson:"Fatma Hanım",contactPhone:"+90 535 444 5566",initialAmount:0,currentAmount:320,totalCollected:1800,collectionCount:6,averageCollection:300,status:"aktif",bankType:"standart",material:"plastik",capacity:1e3,weight:.9,qrCode:"KB004QR",assignedBy:"Admin",createdDate:"2024-04-05",lastModified:"2024-11-18",modifiedBy:"Collector1"},{id:"5",bankNumber:"KB-2024-005",assignedTo:"Kayıp",assignedDate:"2024-05-20",location:"Bilinmiyor",locationDetails:"Son bilinen: Beşiktaş Çarşı",address:"Beşiktaş Çarşı, İstanbul (Son bilinen konum)",contactPerson:"Bilinmiyor",contactPhone:"Bilinmiyor",initialAmount:0,currentAmount:0,totalCollected:450,collectionCount:1,averageCollection:450,status:"kayıp",bankType:"standart",material:"plastik",capacity:1e3,notes:"Kayıp raporu verildi - 2024-10-15",assignedBy:"Admin",createdDate:"2024-05-20",lastModified:"2024-10-15",modifiedBy:"Admin"}],j=[{id:"1",bankId:"1",collectionDate:"2024-11-15",collectedBy:"Collector1",amount:850,currency:"TRY",coinCount:45,billCount:12,condition:"iyi",receiptNumber:"TOP-2024-115",collectorSignature:"İmzalandı",witnessName:"Ahmet Yılmaz",witnessSignature:"İmzalandı",photoTaken:!0,nextCollectionDate:"2024-12-15",notes:"Normal toplama",createdDate:"2024-11-15"},{id:"2",bankId:"2",collectionDate:"2024-11-10",collectedBy:"Collector2",amount:1200,currency:"TRY",coinCount:80,billCount:18,foreignCurrency:[{amount:5,currency:"USD",exchangeRate:34.5,tryEquivalent:172.5},{amount:2,currency:"EUR",exchangeRate:37.2,tryEquivalent:74.4}],condition:"iyi",receiptNumber:"TOP-2024-110",collectorSignature:"İmzalandı",witnessName:"İmam Mehmet Bey",witnessSignature:"İmzalandı",photoTaken:!0,notes:"Yabancı para da var",createdDate:"2024-11-10"},{id:"3",bankId:"3",collectionDate:"2024-11-20",collectedBy:"Collector1",amount:650,currency:"TRY",coinCount:35,billCount:8,condition:"hasarlı",receiptNumber:"TOP-2024-120",collectorSignature:"İmzalandı",witnessName:"Zeynep Öğretmen",witnessSignature:"İmzalandı",photoTaken:!0,notes:"Kilit problemi tespit edildi",createdDate:"2024-11-20"}],y=[{id:"1",bankId:"1",assignedTo:"Ahmet Market",assignedDate:"2024-01-15",location:"Fatih/İstanbul",locationDetails:"Ahmet Market - Kasa yanı",contactPerson:"Ahmet Yılmaz",contactPhone:"+90 532 123 4567",expectedDuration:365,targetAmount:5e3,purpose:"Genel bağış toplama",assignedBy:"Admin",status:"aktif",notes:"Yıllık anlaşma",createdDate:"2024-01-15"},{id:"2",bankId:"2",assignedTo:"Merkez Cami",assignedDate:"2024-02-01",location:"Üsküdar/İstanbul",locationDetails:"Merkez Cami - Giriş holü",contactPerson:"İmam Mehmet Bey",contactPhone:"+90 533 987 6543",expectedDuration:365,targetAmount:8e3,purpose:"Cami bakım ve yardım fonu",assignedBy:"Admin",status:"aktif",notes:"Cuma namazı sonrası aktif",createdDate:"2024-02-01"}];function N(){const[n,r]=a.useState(b),[i]=a.useState(j),[o]=a.useState(y),[d,x]=a.useState(""),[N,k]=a.useState(""),[v,f]=a.useState(""),[C,w]=a.useState(""),[T,S]=a.useState(!1),[D,A]=a.useState(!1),[K,R]=a.useState(!1),[B,M]=a.useState(!1),[z,P]=a.useState(!1),[L,O]=a.useState(null),[I,Q]=a.useState(null),[Y,q]=a.useState(null),[E,$]=a.useState(null),[F,U]=a.useState("banks"),[G,_]=a.useState({bankNumber:"",assignedTo:"",location:"",locationDetails:"",address:"",contactPerson:"",contactPhone:"",contactEmail:"",bankType:"standart",material:"plastik",capacity:"",weight:"",notes:""}),H=a.useMemo(()=>n.filter(e=>{const a=JSON.stringify(e).toLowerCase().includes(d.toLowerCase()),t=!N||e.status===N,s=!v||e.location.toLowerCase().includes(v.toLowerCase()),l=!C||e.bankType===C;return a&&t&&s&&l}),[n,d,N,v,C]),J=a.useMemo(()=>i.filter(e=>JSON.stringify(e).toLowerCase().includes(d.toLowerCase())),[i,d]),V=a.useMemo(()=>o.filter(e=>JSON.stringify(e).toLowerCase().includes(d.toLowerCase())),[o,d]),Z=H.length,W=H.filter(e=>"aktif"===e.status).length,X=H.filter(e=>"dolu"===e.status).length,ee=H.filter(e=>"bakımda"===e.status).length,ae=H.filter(e=>"kayıp"===e.status).length,te=H.reduce((e,a)=>e+a.currentAmount,0),se=H.reduce((e,a)=>e+a.totalCollected,0),le=H.reduce((e,a)=>e+a.collectionCount,0),ne=Z>0?se/Z:0,re=le>0?se/le:0,ie=[{key:"bankNumber",header:"Kumbara No"},{key:"assignedTo",header:"Atanan Yer"},{key:"location",header:"Lokasyon"},{key:"address",header:"Adres",render:(a,t)=>e.jsx("button",{onClick:()=>ue(t),className:"text-blue-600 hover:text-blue-800 underline text-sm max-w-32 truncate text-left",title:t.address||t.locationDetails,children:t.address||t.locationDetails})},{key:"contactPerson",header:"İletişim"},{key:"contactPhone",header:"Telefon"},{key:"currentAmount",header:"Mevcut/Toplam",render:(a,t)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:[t.currentAmount.toLocaleString("tr-TR")," ₺"]}),e.jsxs("div",{className:"text-gray-500",children:[t.totalCollected.toLocaleString("tr-TR")," ₺"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.collectionCount," toplama"]})]})},{key:"bankType",header:"Tip/Kapasite",render:(a,t)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:t.bankType}),e.jsxs("div",{className:"text-gray-500",children:[t.capacity," ₺"]}),e.jsx("div",{className:"text-xs text-gray-400",children:t.material})]})},{key:"lastCollectionDate",header:"Son Toplama",render:(a,t)=>e.jsx("div",{className:"text-sm",children:t.lastCollectionDate?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(t.lastCollectionDate).toLocaleDateString("tr-TR")}),e.jsxs("div",{className:"text-gray-500",children:[t.lastCollectionAmount?.toLocaleString("tr-TR")," ₺"]})]}):e.jsx("span",{className:"text-gray-400",children:"Henüz yok"})})},{key:"status",header:"Durum",render:(a,t)=>e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("aktif"===t.status?"bg-green-100 text-green-800":"dolu"===t.status?"bg-blue-100 text-blue-800":"bakımda"===t.status?"bg-yellow-100 text-yellow-800":"kayıp"===t.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.status})},{key:"id",header:"İşlemler",render:(a,t)=>e.jsxs("div",{className:"flex gap-1 text-xs flex-wrap",children:[e.jsx("button",{onClick:()=>ce(t),className:"text-blue-600 hover:text-blue-800 px-2 py-1 rounded",children:"Düzenle"}),e.jsx("button",{onClick:()=>me(t),className:"text-green-600 hover:text-green-800 px-2 py-1 rounded",children:"Toplamalar"}),e.jsx("button",{onClick:()=>he(t),className:"text-orange-600 hover:text-orange-800 px-2 py-1 rounded",children:"QR Kod"}),e.jsx("button",{onClick:()=>xe(t),className:"text-purple-600 hover:text-purple-800 px-2 py-1 rounded",disabled:"aktif"!==t.status&&"dolu"!==t.status,children:"Topla"})]})}],oe=[{key:"collectionDate",header:"Tarih",render:(e,a)=>new Date(a.collectionDate).toLocaleDateString("tr-TR")},{key:"bankId",header:"Kumbara",render:(e,a)=>{const t=n.find(e=>e.id===a.bankId);return t?t.bankNumber:"Bilinmiyor"}},{key:"collectedBy",header:"Toplayan"},{key:"amount",header:"Tutar/Adet",render:(a,t)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:[t.amount.toLocaleString("tr-TR")," ₺"]}),e.jsxs("div",{className:"text-gray-500",children:[t.coinCount,"M + ",t.billCount,"K"]}),t.foreignCurrency&&t.foreignCurrency.length>0&&e.jsx("div",{className:"text-xs text-blue-600",children:"+Yabancı para"})]})},{key:"condition",header:"Durum",render:(a,t)=>e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("iyi"===t.condition?"bg-green-100 text-green-800":"hasarlı"===t.condition?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:t.condition})},{key:"receiptNumber",header:"Makbuz No"},{key:"photoTaken",header:"Fotoğraf",render:(e,a)=>a.photoTaken?"✓":"-"},{key:"witnessName",header:"Şahit"}],de=[{key:"assignedDate",header:"Atama Tarihi",render:(e,a)=>new Date(a.assignedDate).toLocaleDateString("tr-TR")},{key:"bankId",header:"Kumbara",render:(e,a)=>{const t=n.find(e=>e.id===a.bankId);return t?t.bankNumber:"Bilinmiyor"}},{key:"assignedTo",header:"Atanan Yer"},{key:"location",header:"Lokasyon"},{key:"contactPerson",header:"İletişim"},{key:"expectedDuration",header:"Süre/Hedef",render:(a,t)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[t.expectedDuration," gün"]}),t.targetAmount&&e.jsxs("div",{className:"text-gray-500",children:[t.targetAmount.toLocaleString("tr-TR")," ₺"]})]})},{key:"purpose",header:"Amaç"},{key:"status",header:"Durum",render:(a,t)=>e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("aktif"===t.status?"bg-green-100 text-green-800":"tamamlandı"===t.status?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"),children:t.status})},{key:"assignedBy",header:"Atayan"}],ce=e=>{O(e),_({bankNumber:e.bankNumber,assignedTo:e.assignedTo,location:e.location,locationDetails:e.locationDetails,address:e.address||"",contactPerson:e.contactPerson,contactPhone:e.contactPhone,contactEmail:e.contactEmail||"",bankType:e.bankType,material:e.material,capacity:e.capacity.toString(),weight:e.weight?.toString()||"",notes:e.notes||""}),S(!0)},me=e=>{Q(e),A(!0)},xe=e=>{Q(e),alert(`${e.bankNumber} numaralı kumbara için toplama işlemi başlatılacak.`)},ue=e=>{q(e),R(!0)},he=e=>{$(e),P(!0)},pe=()=>{_({bankNumber:"",assignedTo:"",location:"",locationDetails:"",address:"",contactPerson:"",contactPhone:"",contactEmail:"",bankType:"standart",material:"plastik",capacity:"",weight:"",notes:""})},ge=[...new Set(n.map(e=>e.location))];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Kumbara Takibi"}),e.jsxs("div",{className:"flex border rounded",children:[e.jsx("button",{onClick:()=>U("banks"),className:"px-4 py-2 text-sm "+("banks"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Kumbaralar"}),e.jsx("button",{onClick:()=>U("collections"),className:"px-4 py-2 text-sm "+("collections"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Toplamalar"}),e.jsx("button",{onClick:()=>U("assignments"),className:"px-4 py-2 text-sm "+("assignments"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Atamalar"}),e.jsx("button",{onClick:()=>U("analytics"),className:"px-4 py-2 text-sm "+("analytics"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Analitik"})]})]}),"banks"===F&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{M(!0)},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"QR Tara"]}),e.jsx("button",{onClick:()=>{O(null),pe();const e=(n.length+1).toString().padStart(3,"0");_(a=>({...a,bankNumber:`KB-2024-${e}`})),S(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Yeni Kumbara"})]})]}),"banks"===F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-600",children:"Toplam Kumbara"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Z})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-green-600",children:"Aktif"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:W})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-600",children:"Dolu"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:X})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-600",children:"Bakımda"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:ee})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-red-600",children:"Kayıp"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:ae})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-indigo-600",children:"Mevcut Tutar"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-900",children:[te.toLocaleString("tr-TR")," ₺"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("input",{value:d,onChange:e=>x(e.target.value),className:"border rounded px-3 py-2",placeholder:"Kumbara no, yer adı ile ara..."}),e.jsxs("select",{value:N,onChange:e=>k(e.target.value),className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"aktif",children:"Aktif"}),e.jsx("option",{value:"dolu",children:"Dolu"}),e.jsx("option",{value:"bakımda",children:"Bakımda"}),e.jsx("option",{value:"kayıp",children:"Kayıp"}),e.jsx("option",{value:"iptal",children:"İptal"})]}),e.jsxs("select",{value:v,onChange:e=>f(e.target.value),className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Tüm Lokasyonlar"}),ge.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:C,onChange:e=>w(e.target.value),className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Tüm Tipler"}),e.jsx("option",{value:"standart",children:"Standart"}),e.jsx("option",{value:"büyük",children:"Büyük"}),e.jsx("option",{value:"özel",children:"Özel"}),e.jsx("option",{value:"dijital",children:"Dijital"})]}),e.jsx("button",{onClick:()=>t("kumbaralar.csv",H),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Excel İndir"})]}),e.jsx(s,{columns:ie,data:H})]}),"collections"===F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{value:d,onChange:e=>x(e.target.value),className:"border rounded px-3 py-2 w-full max-w-md",placeholder:"Kumbara no, toplayan kişi ile ara..."})}),e.jsx(s,{columns:oe,data:J})]}),"assignments"===F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{value:d,onChange:e=>x(e.target.value),className:"border rounded px-3 py-2 w-full max-w-md",placeholder:"Atanan yer, kişi ile ara..."})}),e.jsx(s,{columns:de,data:V})]}),"analytics"===F&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-600 mb-2",children:"Toplam Gelir"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900",children:[se.toLocaleString("tr-TR")," ₺"]}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Tüm toplamalar"})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-green-600 mb-2",children:"Mevcut Tutar"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900",children:[te.toLocaleString("tr-TR")," ₺"]}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Kumbaralarda"})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-purple-600 mb-2",children:"Kumbara Başına"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-900",children:[ne.toLocaleString("tr-TR")," ₺"]}),e.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"Ortalama gelir"})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-orange-600 mb-2",children:"Toplama Başına"}),e.jsxs("p",{className:"text-3xl font-bold text-orange-900",children:[re.toLocaleString("tr-TR")," ₺"]}),e.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"Ortalama tutar"})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Kumbara Durum Dağılımı"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-1",children:"Aktif"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:W}),e.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(W/Z*100):0]})]}),e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600 mb-1",children:"Dolu"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:X}),e.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(X/Z*100):0]})]}),e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-yellow-600 mb-1",children:"Bakımda"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:ee}),e.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(ee/Z*100):0]})]}),e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-red-600 mb-1",children:"Kayıp"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:ae}),e.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(ae/Z*100):0]})]}),e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"İptal"}),e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:H.filter(e=>"iptal"===e.status).length}),e.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(H.filter(e=>"iptal"===e.status).length/Z*100):0]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lokasyon Performansı"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"Lokasyon"}),e.jsx("th",{className:"text-right py-2",children:"Kumbara Sayısı"}),e.jsx("th",{className:"text-right py-2",children:"Toplam Gelir"}),e.jsx("th",{className:"text-right py-2",children:"Ortalama"}),e.jsx("th",{className:"text-right py-2",children:"Mevcut Tutar"})]})}),e.jsx("tbody",{children:ge.map(a=>{const t=H.filter(e=>e.location===a),s=t.reduce((e,a)=>e+a.totalCollected,0),l=t.reduce((e,a)=>e+a.currentAmount,0),n=t.length>0?s/t.length:0;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:a}),e.jsx("td",{className:"text-right py-2",children:t.length}),e.jsxs("td",{className:"text-right py-2",children:[s.toLocaleString("tr-TR")," ₺"]}),e.jsxs("td",{className:"text-right py-2",children:[n.toLocaleString("tr-TR")," ₺"]}),e.jsxs("td",{className:"text-right py-2",children:[l.toLocaleString("tr-TR")," ₺"]})]},a)})})]})})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Kumbara Tipi Analizi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:["standart","büyük","özel","dijital"].map(a=>{const t=H.filter(e=>e.bankType===a),s=t.reduce((e,a)=>e+a.totalCollected,0),l=t.length>0?s/t.length:0;return e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:a}),e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[t.length," adet"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.toLocaleString("tr-TR")," ₺"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Ort: ",l.toLocaleString("tr-TR")," ₺"]})]},a)})})]})]})]}),e.jsx(l,{isOpen:T,onClose:()=>S(!1),title:L?"Kumbara Düzenle":"Yeni Kumbara",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=parseFloat(G.capacity),t=G.weight?parseFloat(G.weight):void 0;if(L)r(n.map(e=>e.id===L.id?{...e,...G,capacity:a,weight:t,lastModified:(new Date).toISOString().split("T")[0],modifiedBy:"Admin"}:e));else{const e=u(n),s=m({bankNumber:G.bankNumber||e,assignedTo:G.assignedTo,location:G.location,contactPerson:G.contactPerson,contactPhone:G.contactPhone}),l={id:Date.now().toString(),...G,bankNumber:G.bankNumber||e,capacity:a,weight:t,assignedDate:(new Date).toISOString().split("T")[0],initialAmount:0,currentAmount:0,totalCollected:0,collectionCount:0,averageCollection:0,status:"aktif",qrCode:s,assignedBy:"Admin",createdDate:(new Date).toISOString().split("T")[0],lastModified:(new Date).toISOString().split("T")[0],modifiedBy:"Admin"};r([...n,l])}S(!1),O(null),pe()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kumbara Numarası *"}),e.jsx("input",{type:"text",value:G.bankNumber,onChange:e=>_({...G,bankNumber:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"KB-2024-001",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Atanan Yer *"}),e.jsx("input",{type:"text",value:G.assignedTo,onChange:e=>_({...G,assignedTo:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Market, Cami, Okul vb.",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lokasyon *"}),e.jsx("input",{type:"text",value:G.location,onChange:e=>_({...G,location:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"İlçe/İl",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lokasyon Detayı"}),e.jsx("input",{type:"text",value:G.locationDetails,onChange:e=>_({...G,locationDetails:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Kasa yanı, giriş holü vb."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tam Adres"}),e.jsx("input",{type:"text",value:G.address,onChange:e=>_({...G,address:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Mahalle, Cadde/Sokak No, İlçe/İl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Kişisi *"}),e.jsx("input",{type:"text",value:G.contactPerson,onChange:e=>_({...G,contactPerson:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Telefon *"}),e.jsx("input",{type:"tel",value:G.contactPhone,onChange:e=>_({...G,contactPhone:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"E-posta"}),e.jsx("input",{type:"email",value:G.contactEmail,onChange:e=>_({...G,contactEmail:e.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kumbara Tipi"}),e.jsxs("select",{value:G.bankType,onChange:e=>_({...G,bankType:e.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"standart",children:"Standart"}),e.jsx("option",{value:"büyük",children:"Büyük"}),e.jsx("option",{value:"özel",children:"Özel"}),e.jsx("option",{value:"dijital",children:"Dijital"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Malzeme"}),e.jsxs("select",{value:G.material,onChange:e=>_({...G,material:e.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"plastik",children:"Plastik"}),e.jsx("option",{value:"metal",children:"Metal"}),e.jsx("option",{value:"cam",children:"Cam"}),e.jsx("option",{value:"karton",children:"Karton"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kapasite (₺) *"}),e.jsx("input",{type:"number",step:"0.01",value:G.capacity,onChange:e=>_({...G,capacity:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ağırlık (kg)"}),e.jsx("input",{type:"number",step:"0.1",value:G.weight,onChange:e=>_({...G,weight:e.target.value}),className:"w-full border rounded px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{value:G.notes,onChange:e=>_({...G,notes:e.target.value}),className:"w-full border rounded px-3 py-2",rows:3,placeholder:"Kumbara hakkında notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>S(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"İptal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:L?"Güncelle":"Oluştur"})]})]})}),e.jsx(l,{isOpen:D,onClose:()=>A(!1),title:`${I?.bankNumber} - Toplama Geçmişi`,children:I&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Toplam Toplama:"}),e.jsx("span",{className:"ml-2 font-medium",children:I.collectionCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Toplam Gelir:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[I.totalCollected.toLocaleString("tr-TR")," ₺"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ortalama:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[I.averageCollection.toLocaleString("tr-TR")," ₺"]})]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx(s,{columns:oe,data:i.filter(e=>e.bankId===I.id)})})]})}),Y&&e.jsx(p,{isOpen:K,onClose:()=>R(!1),address:Y.address||Y.location,bankNumber:Y.bankNumber,assignedTo:Y.assignedTo}),e.jsx(c,{isOpen:B,onClose:()=>M(!1),onScanSuccess:e=>{if(e&&e.bankNumber){const a=n.find(a=>a.bankNumber===e.bankNumber);a?ce(a):alert("Kumbara bulunamadı!")}M(!1)}}),E&&e.jsx(g,{isOpen:z,onClose:()=>P(!1),bank:E})]})}export{N as default};
