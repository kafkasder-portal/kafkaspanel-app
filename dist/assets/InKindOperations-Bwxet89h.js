import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as t}from"./react-vendor-DCtPEfzS.js";import{s as a,l as s,z as i,au as r,bi as l,d as n,p as o,i as d,bj as c,X as m,a as u,w as x,o as p,E as h,m as y}from"./auth-CY9yrbMl.js";import{e as b,D as g}from"./donations-Cs-DOdlb.js";import{M as j}from"./messages-BdWFJ_-b.js";import{S as v}from"./aid-DdyBfUwd.js";import{u as f,b as _,s as N,n as w,e as k}from"./form-vendor-CfNvelWt.js";import{V as S,t as D}from"./meetings-CSL3uVn4.js";import"./state-vendor-rPBjJaR_.js";import"./supabase-vendor-AMUhAiAi.js";import"./file-vendor-D5NpndWQ.js";import"./utils-vendor-DxpoukG0.js";import"./chart-vendor-CNXqmhrW.js";import"./dashboard-DU4k1qlk.js";const T=_({operation_type:k(["received","distributed","transferred","returned"],{message:"İşlem türü seçiniz"}),item_name:N().min(1,"Ürün adı giriniz"),item_category:N().min(1,"Kategori seçiniz"),quantity:w().min(1,"Miktar giriniz"),unit:N().min(1,"Birim seçiniz"),unit_value:w().optional(),source:N().optional(),destination:N().optional(),beneficiary_id:N().optional(),warehouse_location:N().min(1,"Depo konumu giriniz"),expiry_date:N().optional(),notes:N().optional()}),A=["Gıda","Giyim","Temizlik","Kırtasiye","Oyuncak","Ev Eşyası","Elektronik","Kitap","Diğer"],C=["Adet","Kg","Gram","Litre","Paket","Kutu","Çuval","Koli"],q=["Ana Depo - A Blok","Ana Depo - B Blok","Ana Depo - C Blok","Şube Depo 1","Şube Depo 2","Soğuk Hava Deposu"];function z(){const[_,N]=t.useState([]),[w,k]=t.useState({totalReceived:0,totalDistributed:0,currentStock:0,todayOperations:0}),[z,B]=t.useState(!0),[K,E]=t.useState(""),[L,M]=t.useState("all"),[Y,R]=t.useState("all"),[F,G]=t.useState("all"),[H,O]=t.useState("all"),[$,I]=t.useState(!1),[P,U]=t.useState(null),[V,J]=t.useState([]),{register:Q,handleSubmit:W,formState:{errors:X},reset:Z,watch:ee}=f({resolver:D(T)}),te=ee("operation_type"),ae=ee("quantity"),se=ee("unit_value");t.useEffect(()=>{},[ae,se]),t.useEffect(()=>{ie(),re(),le()},[]);const ie=async()=>{try{const{data:e,error:t}=await a.from("in_kind_aids").select("\n          *,\n          beneficiaries (\n            name,\n            surname,\n            category\n          )\n        ").order("created_at",{ascending:!1});if(t)throw t;const s=e?.map(e=>({id:e.id,operation_type:"distributed",item_name:e.item_name,item_category:e.item_category,quantity:e.quantity,unit:e.unit,unit_value:e.unit_value,total_value:e.total_value,beneficiary_id:e.beneficiary_id,warehouse_location:e.warehouse_location||"Ana Depo - A Blok",expiry_date:e.expiry_date,operation_date:e.distributed_at||e.created_at,status:"distributed"===e.status?"completed":"pending",notes:e.notes,created_at:e.created_at,operator_id:"user1",beneficiaries:e.beneficiaries,operator:{name:"Admin User",email:"admin@example.com"}}))||[];N(s)}catch(e){S.error("Ayni yardım işlemleri yüklenirken hata oluştu")}finally{B(!1)}},re=async()=>{try{const{data:e}=await a.from("in_kind_aids").select("quantity, total_value, status");if(e){const t=e.reduce((e,t)=>e+(t.quantity||0),0),a=e.filter(e=>"distributed"===e.status).reduce((e,t)=>e+(t.quantity||0),0),s=t-a,i=e.filter(e=>{const t=new Date(e.created_at||""),a=new Date;return t.toDateString()===a.toDateString()}).length;k({totalReceived:t,totalDistributed:a,currentStock:s,todayOperations:i})}}catch(e){}},le=async()=>{try{const{data:e,error:t}=await a.from("beneficiaries").select("id, name, surname, category").eq("status","active").order("name");if(t)throw t;J(e||[])}catch(e){}},ne=t.useMemo(()=>_.filter(e=>{const t=""===K||e.item_name.toLowerCase().includes(K.toLowerCase())||e.item_category.toLowerCase().includes(K.toLowerCase())||e.warehouse_location.toLowerCase().includes(K.toLowerCase()),a="all"===L||e.operation_type===L,s="all"===Y||e.item_category===Y,i="all"===F||e.status===F;let r=!0;if("all"!==H){const t=new Date(e.operation_date),a=new Date;switch(H){case"today":r=t.toDateString()===a.toDateString();break;case"week":r=t>=new Date(a.getTime()-6048e5);break;case"month":r=t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear()}}return t&&a&&s&&i&&r}),[_,K,L,Y,F,H]),oe=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(e),de=e=>new Date(e).toLocaleDateString("tr-TR"),ce=[{key:"operation_type",header:"İşlem Türü",render:(t,a)=>(t=>{const a={received:{label:"Alındı",class:"bg-green-100 text-green-800",icon:i},distributed:{label:"Dağıtıldı",class:"bg-blue-100 text-blue-800",icon:r},transferred:{label:"Transfer",class:"bg-purple-100 text-purple-800",icon:l},returned:{label:"İade",class:"bg-orange-100 text-orange-800",icon:c}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:i},s=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),a.label]})})(a.operation_type)},{key:"item_info",header:"Ürün Bilgisi",render:(t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.item_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.item_category})]})},{key:"quantity",header:"Miktar",render:(t,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.quantity," ",a.unit]}),a.unit_value&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Birim: ",oe(a.unit_value)]})]})},{key:"total_value",header:"Toplam Değer",render:(t,a)=>e.jsx("div",{className:"font-medium text-green-600",children:oe(a.total_value)})},{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(t,a)=>e.jsx("div",{children:a.beneficiaries?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[a.beneficiaries.name," ",a.beneficiaries.surname]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.beneficiaries.category})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"warehouse_location",header:"Depo Konumu",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.warehouse_location})]})},{key:"operation_date",header:"İşlem Tarihi",render:(e,t)=>de(t.operation_date)},{key:"expiry_date",header:"Son Kullanma",render:(e,t)=>t.expiry_date?de(t.expiry_date):"-"},{key:"status",header:"Durum",render:(t,a)=>(t=>{const a={pending:{label:"Beklemede",class:"bg-yellow-100 text-yellow-800",icon:x},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:u},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:m}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:u},s=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),a.label]})})(a.status)},{key:"actions",header:"İşlemler",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(h,{className:"h-4 w-4"})}),"pending"===a.status&&e.jsx("button",{onClick:()=>{U(a),I(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(y,{className:"h-4 w-4"})})]})}];return z?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Ayni Yardım İşlemleri"}),e.jsx("p",{className:"text-muted-foreground",children:"Ayni yardım işlemlerini kaydedin ve takip edin"})]}),e.jsxs("button",{onClick:()=>{U(null),I(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(s,{className:"h-4 w-4"}),"Yeni İşlem"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(v,{title:"Toplam Alınan",value:w.totalReceived.toString(),icon:i,accentClass:"bg-green-100"}),e.jsx(v,{title:"Toplam Dağıtılan",value:w.totalDistributed.toString(),icon:r,accentClass:"bg-blue-100"}),e.jsx(v,{title:"Mevcut Stok",value:w.currentStock.toString(),icon:l,accentClass:"bg-purple-100"}),e.jsx(v,{title:"Bugünkü İşlemler",value:w.todayOperations.toString(),icon:n,accentClass:"bg-orange-100"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"İşlem ara...",value:K,onChange:e=>E(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:L,onChange:e=>M(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm İşlem Türleri"}),e.jsx("option",{value:"received",children:"Alınan"}),e.jsx("option",{value:"distributed",children:"Dağıtılan"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),e.jsxs("select",{value:Y,onChange:e=>R(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Kategoriler"}),A.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:F,onChange:e=>G(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"pending",children:"Bekleyen"}),e.jsx("option",{value:"completed",children:"Tamamlanan"}),e.jsx("option",{value:"cancelled",children:"İptal Edilen"})]}),e.jsxs("select",{value:H,onChange:e=>O(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tarihler"}),e.jsx("option",{value:"today",children:"Bugün"}),e.jsx("option",{value:"week",children:"Bu Hafta"}),e.jsx("option",{value:"month",children:"Bu Ay"})]}),e.jsxs("button",{onClick:()=>b("ayni-yardim-islemleri.csv",ne),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(d,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[ne.length," işlem"]})]}),e.jsx(g,{columns:ce,data:ne}),e.jsxs(j,{open:$,onClose:()=>I(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:P?"İşlem Düzenle":"Yeni Ayni Yardım İşlemi"}),e.jsx("button",{onClick:()=>I(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:W(async e=>{try{const t=(e.quantity||0)*(e.unit_value||0),{error:s}=await a.from("in_kind_aids").insert({beneficiary_id:e.beneficiary_id,item_name:e.item_name,item_category:e.item_category,quantity:e.quantity,unit:e.unit,unit_value:e.unit_value,total_value:t,warehouse_location:e.warehouse_location,expiry_date:e.expiry_date,status:"pending",notes:e.notes});if(s)throw s;S.success("Ayni yardım işlemi başarıyla kaydedildi"),I(!1),Z(),ie(),re()}catch(t){S.error("Ayni yardım işlemi kaydedilirken hata oluştu")}}),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İşlem Türü *"}),e.jsxs("select",{...Q("operation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),e.jsx("option",{value:"received",children:"Alındı"}),e.jsx("option",{value:"distributed",children:"Dağıtıldı"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),X.operation_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.operation_type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Kategorisi *"}),e.jsxs("select",{...Q("item_category"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),A.map(t=>e.jsx("option",{value:t,children:t},t))]}),X.item_category&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.item_category.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Adı *"}),e.jsx("input",{type:"text",...Q("item_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürün adını giriniz"}),X.item_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.item_name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Miktar *"}),e.jsx("input",{type:"number",...Q("quantity",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0"}),X.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim *"}),e.jsxs("select",{...Q("unit"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),C.map(t=>e.jsx("option",{value:t,children:t},t))]}),X.unit&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.unit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim Değer"}),e.jsx("input",{type:"number",step:"0.01",...Q("unit_value",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0.00"})]})]}),("distributed"===te||"transferred"===te)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"distributed"===te?"İhtiyaç Sahibi":"Hedef"}),"distributed"===te?e.jsxs("select",{...Q("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),V.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.surname," - ",t.category]},t.id))]}):e.jsx("input",{type:"text",...Q("destination"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hedef konum"})]}),"received"===te&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kaynak"}),e.jsx("input",{type:"text",...Q("source"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürünün geldiği yer"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Depo Konumu *"}),e.jsxs("select",{...Q("warehouse_location"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),q.map(t=>e.jsx("option",{value:t,children:t},t))]}),X.warehouse_location&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.warehouse_location.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Son Kullanma Tarihi"}),e.jsx("input",{type:"date",...Q("expiry_date"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{...Q("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İşlem ile ilgili notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>I(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(s,{className:"h-4 w-4"}),P?"Güncelle":"Kaydet"]})]})]})]})]})}export{z as default};
