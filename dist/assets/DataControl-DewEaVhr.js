import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as a}from"./react-vendor-DCtPEfzS.js";import{D as t,e as s}from"./donations-Cc8AcqVz.js";import{M as r}from"./messages-C4gZlbNu.js";import{S as l}from"./aid-DvwBo_vc.js";import{u as n,b as i,s as o,e as d}from"./form-vendor-CfNvelWt.js";import{V as c,t as u}from"./meetings-bbWcv5Hc.js";import{g as m,l as x,B as h,y as p,X as g,a8 as b,p as y,i as _,w as j,x as f,D as v,E as k,m as w}from"./auth-9wZfjiou.js";import"./dashboard-CJXjh513.js";import"./file-vendor-D5NpndWQ.js";import"./utils-vendor-DxpoukG0.js";import"./state-vendor-rPBjJaR_.js";import"./chart-vendor-BDEFy5qM.js";import"./supabase-vendor-AMUhAiAi.js";const N=i({table_name:o().min(1,"Tablo adı seçiniz"),validation_type:d(["integrity","consistency","completeness","accuracy","duplicates"],{message:"Doğrulama tipi seçiniz"}),field_name:o().optional(),rule_description:o().min(1,"Kural açıklaması giriniz"),details:o().optional(),suggested_action:o().optional()}),S=["beneficiaries","aid_applications","cash_aids","bank_orders","service_tracking","hospital_referrals","parameters","users","donations","reports"],D=[{value:"integrity",label:"Veri Bütünlüğü"},{value:"consistency",label:"Tutarlılık"},{value:"completeness",label:"Eksiksizlik"},{value:"accuracy",label:"Doğruluk"},{value:"duplicates",label:"Tekrar Eden Kayıtlar"}];function T(){const[i,o]=a.useState([]),[d,T]=a.useState([]),[C,z]=a.useState({totalValidations:0,passedValidations:0,failedValidations:0,warningValidations:0,totalRecords:0,errorRecords:0,dataQualityScore:0}),[I,O]=a.useState(!0),[V,K]=a.useState(""),[M,B]=a.useState("all"),[$,L]=a.useState("all"),[E,R]=a.useState("all"),[A,Y]=a.useState(!1),[Q,U]=a.useState(null),[G,H]=a.useState(!0),[P,F]=a.useState(null),{register:q,handleSubmit:J,formState:{errors:W},reset:X}=n({resolver:u(N)});a.useEffect(()=>{Z(),ee(),ae()},[]);const Z=async()=>{try{const e=[{id:"1",table_name:"beneficiaries",validation_type:"completeness",field_name:"phone",rule_description:"Telefon numarası zorunlu alanların kontrolü",status:"warning",error_count:15,total_records:250,error_percentage:6,last_check:(new Date).toISOString(),created_at:(new Date).toISOString(),details:"15 kayıtta telefon numarası eksik",suggested_action:"Eksik telefon numaralarını tamamlayın"},{id:"2",table_name:"aid_applications",validation_type:"duplicates",field_name:"beneficiary_id",rule_description:"Aynı kişiden birden fazla aktif başvuru kontrolü",status:"failed",error_count:8,total_records:180,error_percentage:4.4,last_check:new Date(Date.now()-72e5).toISOString(),created_at:(new Date).toISOString(),details:"8 kişinin birden fazla aktif başvurusu var",suggested_action:"Tekrar eden başvuruları birleştirin veya iptal edin"},{id:"3",table_name:"cash_aids",validation_type:"integrity",field_name:"amount",rule_description:"Yardım tutarının pozitif olması kontrolü",status:"passed",error_count:0,total_records:95,error_percentage:0,last_check:new Date(Date.now()-18e5).toISOString(),created_at:(new Date).toISOString(),details:"Tüm yardım tutarları pozitif",suggested_action:""},{id:"4",table_name:"beneficiaries",validation_type:"accuracy",field_name:"birth_date",rule_description:"Doğum tarihinin mantıklı aralıkta olması kontrolü",status:"warning",error_count:3,total_records:250,error_percentage:1.2,last_check:new Date(Date.now()-144e5).toISOString(),created_at:(new Date).toISOString(),details:"3 kayıtta şüpheli doğum tarihi (100+ yaş)",suggested_action:"Doğum tarihlerini kontrol edin"},{id:"5",table_name:"bank_orders",validation_type:"consistency",field_name:"status",rule_description:"Ödeme durumu ile tarih alanlarının tutarlılığı",status:"passed",error_count:0,total_records:45,error_percentage:0,last_check:new Date(Date.now()-36e5).toISOString(),created_at:(new Date).toISOString(),details:"Tüm ödeme durumları tutarlı",suggested_action:""}];o(e)}catch(e){c.error("Veri doğrulama kayıtları yüklenirken hata oluştu")}finally{O(!1)}},ee=async()=>{try{const e=[{table_name:"beneficiaries",record_count:250,last_updated:new Date(Date.now()-72e5).toISOString(),health_score:85,issues:2,status:"warning"},{table_name:"aid_applications",record_count:180,last_updated:new Date(Date.now()-18e5).toISOString(),health_score:75,issues:3,status:"warning"},{table_name:"cash_aids",record_count:95,last_updated:new Date(Date.now()-36e5).toISOString(),health_score:95,issues:0,status:"healthy"},{table_name:"bank_orders",record_count:45,last_updated:new Date(Date.now()-27e5).toISOString(),health_score:92,issues:1,status:"healthy"}];T(e)}catch(e){}},ae=async()=>{try{z({totalValidations:25,passedValidations:15,failedValidations:4,warningValidations:6,totalRecords:1250,errorRecords:45,dataQualityScore:87})}catch(e){}},te=a.useMemo(()=>i.filter(e=>{const a=""===V||e.table_name.toLowerCase().includes(V.toLowerCase())||e.rule_description.toLowerCase().includes(V.toLowerCase())||e.field_name?.toLowerCase().includes(V.toLowerCase())||e.details?.toLowerCase().includes(V.toLowerCase()),t="all"===M||e.table_name===M,s="all"===$||e.validation_type===$,r="all"===E||e.status===E;return a&&t&&s&&r}),[i,V,M,$,E]),se=e=>new Date(e).toLocaleString("tr-TR"),re=e=>{const a=new Date,t=new Date(e),s=a.getTime()-t.getTime(),r=Math.floor(s/6e4),l=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<60?`${r} dakika önce`:l<24?`${l} saat önce`:`${n} gün önce`},le=[{key:"table_info",header:"Tablo & Alan",render:(a,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(v,{className:"h-3 w-3 text-blue-600"}),t.table_name]}),t.field_name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.field_name})]})},{key:"validation_type",header:"Tip",render:(a,t)=>(a=>{const t={integrity:{label:"Bütünlük",class:"bg-blue-100 text-blue-800"},consistency:{label:"Tutarlılık",class:"bg-purple-100 text-purple-800"},completeness:{label:"Eksiksizlik",class:"bg-orange-100 text-orange-800"},accuracy:{label:"Doğruluk",class:"bg-green-100 text-green-800"},duplicates:{label:"Tekrar",class:"bg-red-100 text-red-800"}}[a]||{label:a,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:t.label})})(t.validation_type)},{key:"rule_description",header:"Kural",render:(a,t)=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"text-sm truncate",title:t.rule_description,children:t.rule_description}),t.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",title:t.details,children:t.details})]})},{key:"status",header:"Durum",render:(a,t)=>(a=>{const t={passed:{label:"Başarılı",class:"bg-green-100 text-green-800",icon:p},failed:{label:"Başarısız",class:"bg-red-100 text-red-800",icon:g},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:b},pending:{label:"Bekliyor",class:"bg-gray-100 text-gray-800",icon:j}}[a]||{label:a,class:"bg-gray-100 text-gray-800",icon:f},s=t.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),t.label]})})(t.status)},{key:"results",header:"Sonuçlar",render:(a,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:t.error_count>0?"text-red-600 font-medium":"text-green-600",children:t.error_count}),e.jsxs("span",{className:"text-muted-foreground",children:[" / ",t.total_records]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["%",t.error_percentage.toFixed(1)," hata"]}),t.error_percentage>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-1",children:e.jsx("div",{className:"h-1 rounded-full "+(t.error_percentage<5?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(t.error_percentage,100)}%`}})})]})},{key:"last_check",header:"Son Kontrol",render:(a,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:re(t.last_check)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:se(t.last_check)})]})},{key:"actions",header:"İşlemler",render:(a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{F(e),await new Promise(e=>setTimeout(e,2e3));const a={error_count:Math.floor(20*Math.random()),total_records:100+Math.floor(200*Math.random())};o(t=>t.map(t=>{if(t.id===e){const e=a.error_count/a.total_records*100,s=0===e?"passed":e<5?"warning":"failed";return{...t,...a,error_percentage:e,status:s,last_check:(new Date).toISOString()}}return t})),c.success("Doğrulama başarıyla çalıştırıldı")}catch(a){c.error("Doğrulama çalıştırılırken hata oluştu")}finally{F(null)}})(t.id),disabled:P===t.id||"all"===P,className:"rounded p-1 text-blue-600 hover:bg-blue-50 disabled:opacity-50",title:"Doğrulamayı Çalıştır",children:P===t.id?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}):e.jsx(m,{className:"h-4 w-4"})}),e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{U(t),Y(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(w,{className:"h-4 w-4"})})]})}],ne=[{key:"table_name",header:"Tablo",render:(a,t)=>e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(v,{className:"h-4 w-4 text-blue-600"}),t.table_name]})},{key:"record_count",header:"Kayıt Sayısı",render:(a,t)=>e.jsx("div",{className:"text-sm font-medium",children:t.record_count.toLocaleString()})},{key:"health_score",header:"Sağlık Skoru",render:(a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:["%",t.health_score]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full "+(t.health_score>=90?"bg-green-500":t.health_score>=70?"bg-yellow-500":"bg-red-500"),style:{width:`${t.health_score}%`}})})]})},{key:"issues",header:"Sorunlar",render:(a,t)=>e.jsx("div",{className:"text-sm font-medium "+(0===t.issues?"text-green-600":"text-red-600"),children:t.issues})},{key:"status",header:"Durum",render:(a,t)=>(a=>{const t={healthy:{label:"Sağlıklı",class:"bg-green-100 text-green-800",icon:p},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:b},critical:{label:"Kritik",class:"bg-red-100 text-red-800",icon:f}}[a]||{label:a,class:"bg-gray-100 text-gray-800",icon:f},s=t.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),t.label]})})(t.status)},{key:"last_updated",header:"Son Güncelleme",render:(a,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:re(t.last_updated)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:se(t.last_updated)})]})}];return I?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Veri Kontrolü"}),e.jsx("p",{className:"text-muted-foreground",children:"Veri kalitesini izleyin ve doğrulama kurallarını yönetin"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:async()=>{try{F("all"),await new Promise(e=>setTimeout(e,5e3)),o(e=>e.map(e=>{const a=Math.floor(20*Math.random()),t=100+Math.floor(200*Math.random()),s=a/t*100;return{...e,error_count:a,total_records:t,error_percentage:s,status:0===s?"passed":s<5?"warning":"failed",last_check:(new Date).toISOString()}})),c.success("Tüm doğrulamalar başarıyla çalıştırıldı"),ae(),ee()}catch(e){c.error("Doğrulamalar çalıştırılırken hata oluştu")}finally{F(null)}},disabled:"all"===P,className:"flex items-center gap-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700 disabled:opacity-50",children:["all"===P?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):e.jsx(m,{className:"h-4 w-4"}),"Tümünü Çalıştır"]}),e.jsxs("button",{onClick:()=>{U(null),Y(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(x,{className:"h-4 w-4"}),"Yeni Kural"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{title:"Veri Kalite Skoru",value:`%${C.dataQualityScore}`,icon:h,accentClass:"bg-blue-100"}),e.jsx(l,{title:"Başarılı Doğrulamalar",value:C.passedValidations.toString(),icon:p,accentClass:"bg-green-100"}),e.jsx(l,{title:"Başarısız Doğrulamalar",value:C.failedValidations.toString(),icon:g,accentClass:"bg-red-100"}),e.jsx(l,{title:"Hatalı Kayıtlar",value:`${C.errorRecords} / ${C.totalRecords}`,icon:b,accentClass:"bg-yellow-100"})]}),G&&e.jsxs("div",{className:"rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Tablo Sağlık Durumu"}),e.jsx("button",{onClick:()=>H(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(g,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-4",children:e.jsx(t,{columns:ne,data:d})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Doğrulama ara...",value:V,onChange:e=>K(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:M,onChange:e=>B(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tablolar"}),S.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:$,onChange:e=>L(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tipler"}),D.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{value:E,onChange:e=>R(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"passed",children:"Başarılı"}),e.jsx("option",{value:"failed",children:"Başarısız"}),e.jsx("option",{value:"warning",children:"Uyarı"}),e.jsx("option",{value:"pending",children:"Bekleyen"})]}),e.jsxs("button",{onClick:()=>s("veri-kontrol.csv",te),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(_,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[te.length," doğrulama"]})]}),e.jsx(t,{columns:le,data:te}),e.jsxs(r,{open:A,onClose:()=>Y(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:Q?"Doğrulama Kuralı Düzenle":"Yeni Doğrulama Kuralı"}),e.jsx("button",{onClick:()=>Y(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:J(async e=>{try{const a={id:Date.now().toString(),...e,status:"pending",error_count:0,total_records:0,error_percentage:0,last_check:(new Date).toISOString(),created_at:(new Date).toISOString()};Q?(o(e=>e.map(e=>e.id===Q.id?{...a,id:Q.id}:e)),c.success("Doğrulama kuralı başarıyla güncellendi")):(o(e=>[a,...e]),c.success("Doğrulama kuralı başarıyla oluşturuldu")),Y(!1),X(),ae()}catch(a){c.error("Doğrulama kuralı kaydedilirken hata oluştu")}}),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tablo *"}),e.jsxs("select",{...q("table_name"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),S.map(a=>e.jsx("option",{value:a,children:a},a))]}),W.table_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.table_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Doğrulama Tipi *"}),e.jsxs("select",{...q("validation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),D.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),W.validation_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.validation_type.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alan Adı"}),e.jsx("input",{type:"text",...q("field_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Kontrol edilecek alan adı (opsiyonel)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kural Açıklaması *"}),e.jsx("textarea",{...q("rule_description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Doğrulama kuralının açıklaması..."}),W.rule_description&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.rule_description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Detaylar"}),e.jsx("textarea",{...q("details"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ek detaylar ve açıklamalar..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Önerilen Eylem"}),e.jsx("textarea",{...q("suggested_action"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hata durumunda önerilen eylem..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>Y(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(x,{className:"h-4 w-4"}),Q?"Güncelle":"Kaydet"]})]})]})]})]})}export{T as default};
