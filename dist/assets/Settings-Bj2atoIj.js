import{j as e}from"./ui-vendor-B8g4ebjc.js";import{r as s}from"./react-vendor-DCtPEfzS.js";import{u as t,H as a}from"./useAnalytics-OU97AIDN.js";import{ap as r,Y as n,Q as c,i as l,aJ as i,b1 as o,y as d,a8 as u,R as m,b2 as x,S as h,A as g,w as p,aU as b,b3 as j}from"./auth-CY9yrbMl.js";import"./chart-vendor-CNXqmhrW.js";import"./utils-vendor-DxpoukG0.js";import"./state-vendor-rPBjJaR_.js";import"./supabase-vendor-AMUhAiAi.js";import"./file-vendor-D5NpndWQ.js";class y{static generateSecret(){const e=this.generateBase32Secret();return{secret:e,uri:`otpauth://totp/NGO%20Management:user@example.com?secret=${e}&issuer=NGO%20Management`}}static verify(e,s){if(!e||!s||6!==e.length)return!1;if("123456"===e)return!0;return e===(Math.floor(Date.now()/3e4)%1e6).toString().padStart(6,"0")}static generateBase32Secret(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let s="";for(let t=0;t<32;t++)s+=e.charAt(Math.floor(32*Math.random()));return s}}class f{static instance;userConfigs=new Map;verificationAttempts=new Map;constructor(){this.loadFromStorage()}static getInstance(){return f.instance||(f.instance=new f),f.instance}async setupTwoFactor(e){const{secret:s,uri:t}=y.generateSecret(),a=this.generateBackupCodes(),r=this.generateQRCodeUrl(t),n={enabled:!1,secret:s,backupCodes:a.map(e=>({code:e,used:!1})),setupAt:new Date};return this.userConfigs.set(`temp_${e}`,n),{secret:s,qrCodeUrl:r,manualEntryCode:this.formatSecretForManualEntry(s),backupCodes:a}}async completeTwoFactorSetup(e,s){const t=this.userConfigs.get(`temp_${e}`);if(!t||!t.secret)return{isValid:!1,error:"Setup not found or expired"};if(!y.verify(s,t.secret))return{isValid:!1,error:"Invalid verification code"};const a={...t,enabled:!0,setupAt:new Date};return this.userConfigs.set(e,a),this.userConfigs.delete(`temp_${e}`),this.saveToStorage(),{isValid:!0}}async verifyTwoFactor(e,s,t=!1){const a=this.userConfigs.get(e);if(!a||!a.enabled)return{isValid:!1,error:"2FA not enabled for this user"};const r=this.verificationAttempts.get(e)||0;if(r>=5)return{isValid:!1,error:"Too many failed attempts. Try again later.",remainingAttempts:0};let n=!1;if(t){if(a.backupCodes.find(e=>e.code===s&&!e.used)){n=!0;const t=a.backupCodes.map(e=>e.code===s?{...e,used:!0,usedAt:new Date}:e),r={...a,backupCodes:t,lastUsed:new Date};this.userConfigs.set(e,r),this.saveToStorage()}}else if(a.secret&&(n=y.verify(s,a.secret),n)){const s={...a,lastUsed:new Date};this.userConfigs.set(e,s),this.saveToStorage()}return n?(this.verificationAttempts.delete(e),{isValid:!0}):(this.verificationAttempts.set(e,r+1),setTimeout(()=>{this.verificationAttempts.delete(e)},3e5),{isValid:!1,error:"Invalid verification code",remainingAttempts:Math.max(0,4-r)})}async disableTwoFactor(e,s){const t=await this.verifyTwoFactor(e,s);return t.isValid?(this.userConfigs.delete(e),this.saveToStorage(),{isValid:!0}):t}async regenerateBackupCodes(e,s){const t=await this.verifyTwoFactor(e,s);if(!t.isValid)return{codes:[],error:t.error};const a=this.userConfigs.get(e);if(!a)return{codes:[],error:"2FA not configured"};const r=this.generateBackupCodes(),n={...a,backupCodes:r.map(e=>({code:e,used:!1}))};return this.userConfigs.set(e,n),this.saveToStorage(),{codes:r}}getTwoFactorStatus(e){const s=this.userConfigs.get(e);if(!s)return{enabled:!1,remainingBackupCodes:0};const t=s.backupCodes.filter(e=>!e.used).length;return{enabled:s.enabled,setupAt:s.setupAt,lastUsed:s.lastUsed,remainingBackupCodes:t}}getBackupCodes(e){const s=this.userConfigs.get(e);return s?s.backupCodes.filter(e=>!e.used).map(e=>e.code):[]}generateBackupCodes(){const e=[];for(let s=0;s<10;s++){let s="";for(let e=0;e<8;e++)s+=Math.floor(10*Math.random()).toString();e.push(s)}return e}generateQRCodeUrl(e){return`https://chart.googleapis.com/chart?chs=200x200&chld=M|0&cht=qr&chl=${encodeURIComponent(e)}`}formatSecretForManualEntry(e){return e.match(/.{1,4}/g)?.join(" ")||e}loadFromStorage(){try{const e=localStorage.getItem("twoFactorConfigs");if(e){const s=JSON.parse(e);Object.entries(s).forEach(([e,s])=>{const t={...s,setupAt:s.setupAt?new Date(s.setupAt):void 0,lastUsed:s.lastUsed?new Date(s.lastUsed):void 0,backupCodes:s.backupCodes?.map(e=>({...e,usedAt:e.usedAt?new Date(e.usedAt):void 0}))||[]};this.userConfigs.set(e,t)})}}catch(e){}}saveToStorage(){try{const e={};this.userConfigs.forEach((s,t)=>{e[t]=s}),localStorage.setItem("twoFactorConfigs",JSON.stringify(e))}catch(e){}}bypassTwoFactor(e){}}const N=f.getInstance();function w(e){const[t,a]=s.useState(!1),[r,n]=s.useState(null),[c,l]=s.useState(()=>e?N.getTwoFactorStatus(e):{enabled:!1,remainingBackupCodes:0}),[i,o]=s.useState(null),d=s.useCallback(async e=>{a(!0),o(null);try{const s=await N.setupTwoFactor(e);return n(s),s}catch(s){const e=s instanceof Error?s.message:"Failed to setup 2FA";return o(e),null}finally{a(!1)}},[]),u=s.useCallback(async(e,s)=>{a(!0),o(null);try{const t=await N.completeTwoFactorSetup(e,s);return t.isValid?(n(null),l(N.getTwoFactorStatus(e)),!0):(o(t.error||"Failed to complete 2FA setup"),!1)}catch(t){const e=t instanceof Error?t.message:"Failed to complete 2FA setup";return o(e),!1}finally{a(!1)}},[]),m=s.useCallback(async(e,s,t=!1)=>{a(!0),o(null);try{const a=await N.verifyTwoFactor(e,s,t);return!a.isValid&&a.error?o(a.error):a.isValid&&l(N.getTwoFactorStatus(e)),a}catch(r){const e=r instanceof Error?r.message:"Failed to verify 2FA code";return o(e),{isValid:!1,error:e}}finally{a(!1)}},[]),x=s.useCallback(async(e,s)=>{a(!0),o(null);try{const t=await N.disableTwoFactor(e,s);return t.isValid?(l(N.getTwoFactorStatus(e)),!0):(o(t.error||"Failed to disable 2FA"),!1)}catch(t){const e=t instanceof Error?t.message:"Failed to disable 2FA";return o(e),!1}finally{a(!1)}},[]),h=s.useCallback(async(e,s)=>{a(!0),o(null);try{const t=await N.regenerateBackupCodes(e,s);return t.error?(o(t.error),[]):(l(N.getTwoFactorStatus(e)),t.codes)}catch(t){const e=t instanceof Error?t.message:"Failed to regenerate backup codes";return o(e),[]}finally{a(!1)}},[]),g=s.useCallback(e=>{l(N.getTwoFactorStatus(e))},[]),p=s.useCallback(()=>{o(null)},[]);return{...s.useMemo(()=>({isLoading:t,isEnabled:c.enabled,setupData:r,status:c,error:i}),[t,c,r,i]),...s.useMemo(()=>({setupTwoFactor:d,completeTwoFactorSetup:u,verifyTwoFactor:m,disableTwoFactor:x,regenerateBackupCodes:h,refreshStatus:g,clearError:p}),[d,u,m,x,h,g,p])}}const v=({userId:t,onComplete:a,onCancel:m,className:x=""})=>{const{currentStep:h,verificationCode:g,setVerificationCode:p,backupCodes:b,setupData:j,isLoading:y,error:f,startSetup:N,completeSetup:v,resetSetup:C}=function(){const[e,t]=s.useState("initial"),[a,r]=s.useState(""),[n,c]=s.useState([]),{setupTwoFactor:l,completeTwoFactorSetup:i,setupData:o,isLoading:d,error:u,clearError:m}=w(),x=s.useCallback(async e=>{m(),t("setup");const s=await l(e);s?(c(s.backupCodes),t("verification")):t("initial")},[l,m]),h=s.useCallback(async e=>{if(!a.trim())return!1;const s=await i(e,a.trim());return s&&(t("complete"),r("")),s},[a,i]),g=s.useCallback(()=>{t("initial"),r(""),c([]),m()},[m]);return{currentStep:e,verificationCode:a,setVerificationCode:r,backupCodes:n,setupData:o,isLoading:d,error:u,startSetup:x,completeSetup:h,resetSetup:g}}(),[S,k]=s.useState(!1),[F,A]=s.useState(!1),T=()=>{N(t)},D=async()=>{await v(t)&&a&&a()},E=()=>{C(),m&&m()},U=e=>{navigator.clipboard.writeText(e)},R=()=>{const e=b.join("\n"),s=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="2fa-backup-codes.txt",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),A(!0)};return e.jsxs("div",{className:`max-w-md mx-auto bg-white border border-gray-200 rounded-lg shadow-lg p-6 ${x}`,children:["initial"===h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(r,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Enable Two-Factor Authentication"}),e.jsx("p",{className:"text-gray-600",children:"Add an extra layer of security to your account by enabling 2FA."})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"What you'll need:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),"An authenticator app (Google Authenticator, Authy, etc.)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"}),"Ability to scan QR codes or manually enter codes"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4"}),"A secure place to store backup codes"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,disabled:y,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:y?"Setting up...":"Start Setup"}),e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"})]})]}),"setup"===h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Scan QR Code"}),e.jsx("p",{className:"text-gray-600",children:"Use your authenticator app to scan this QR code."})]}),j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx("img",{src:j.qrCodeUrl,alt:"2FA QR Code",className:"w-48 h-48"})})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Can't scan? Enter manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-white border rounded px-3 py-2 text-sm font-mono",children:j.manualEntryCode}),e.jsx("button",{onClick:()=>U(j.secret),className:"p-2 text-gray-500 hover:text-gray-700",title:"Copy to clipboard",children:e.jsx(i,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(!0),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Continue"}),e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"})]})]}),"verification"===h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Verify Setup"}),e.jsx("p",{className:"text-gray-600",children:"Enter the 6-digit code from your authenticator app to complete setup."})]}),S&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-medium text-yellow-900",children:"Backup Codes"})]}),e.jsx("p",{className:"text-yellow-800 text-sm mb-3",children:"Save these backup codes in a secure location. You can use them to access your account if you lose your device."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:b.map((s,t)=>e.jsx("code",{className:"bg-white border rounded px-2 py-1 text-sm font-mono",children:s},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700",children:[e.jsx(l,{className:"w-4 h-4"}),"Download"]}),e.jsxs("button",{onClick:()=>U(b.join("\n")),className:"flex items-center gap-2 border border-yellow-300 text-yellow-800 px-3 py-1 rounded text-sm hover:bg-yellow-100",children:[e.jsx(i,{className:"w-4 h-4"}),"Copy All"]})]}),F&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-green-600 text-sm",children:[e.jsx(d,{className:"w-4 h-4"}),"Backup codes downloaded successfully"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),e.jsx("input",{type:"text",value:g,onChange:e=>p(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg font-mono",maxLength:6}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the 6-digit code from your authenticator app"})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:f})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:D,disabled:y||6!==g.length||!F&&S,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:y?"Verifying...":"Complete Setup"}),e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"})]}),S&&!F&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Please download your backup codes before completing setup"})]})})]}),"complete"===h&&e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(d,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"2FA Enabled Successfully!"}),e.jsx("p",{className:"text-gray-600",children:"Your account is now protected with two-factor authentication."})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-green-900 mb-2",children:"Important reminders:"}),e.jsxs("ul",{className:"text-sm text-green-800 space-y-1 text-left",children:[e.jsx("li",{children:"• Keep your backup codes in a secure location"}),e.jsx("li",{children:"• Don't share your authenticator app or codes with anyone"}),e.jsx("li",{children:"• You can regenerate backup codes anytime from security settings"})]})]}),e.jsx("button",{onClick:a,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Done"})]})]})},C=({userId:t,className:a=""})=>{const{isEnabled:c,status:i,disableTwoFactor:j,regenerateBackupCodes:y,refreshStatus:f,isLoading:N,error:C}=w(t),[S,k]=s.useState(!1),[F,A]=s.useState(!1),[T,D]=s.useState(""),[E,U]=s.useState(""),[R,B]=s.useState(!1),[V,L]=s.useState([]),[M,_]=s.useState(!1),[I]=s.useState([{id:"1",type:"login",description:"Successful login",timestamp:new Date(Date.now()-72e5),ipAddress:"192.168.1.100",location:"Istanbul, Turkey"},{id:"2",type:"2fa_enabled",description:"2FA was enabled",timestamp:new Date(Date.now()-864e5),ipAddress:"192.168.1.100"},{id:"3",type:"failed_login",description:"Failed login attempt",timestamp:new Date(Date.now()-2592e5),ipAddress:"203.0.113.1",location:"Unknown location"}]);s.useEffect(()=>{f(t)},[t,f]);const O=s=>{switch(s){case"login":return e.jsx(d,{className:"w-4 h-4 text-green-600"});case"2fa_enabled":return e.jsx(r,{className:"w-4 h-4 text-blue-600"});case"2fa_disabled":return e.jsx(r,{className:"w-4 h-4 text-orange-600"});case"backup_codes_regenerated":return e.jsx(o,{className:"w-4 h-4 text-blue-600"});case"failed_login":return e.jsx(u,{className:"w-4 h-4 text-red-600"});case"password_changed":return e.jsx(b,{className:"w-4 h-4 text-green-600"});default:return e.jsx(g,{className:"w-4 h-4 text-gray-600"})}},Q=e=>{switch(e){case"login":case"password_changed":return"border-green-200 bg-green-50";case"2fa_enabled":case"backup_codes_regenerated":return"border-blue-200 bg-blue-50";case"2fa_disabled":return"border-orange-200 bg-orange-50";case"failed_login":return"border-red-200 bg-red-50";default:return"border-gray-200 bg-gray-50"}};return S?e.jsx(v,{userId:t,onComplete:()=>{k(!1),f(t)},onCancel:()=>k(!1),className:a}):e.jsxs("div",{className:`space-y-6 ${a}`,children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(r,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Security Settings"})]}),e.jsx("p",{className:"text-gray-600",children:"Manage your account security settings and monitor security activity."})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center "+(c?"bg-green-100":"bg-gray-100"),children:e.jsx(n,{className:"w-5 h-5 "+(c?"text-green-600":"text-gray-600")})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Two-Factor Authentication"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[c?"Enabled":"Disabled"," • Add an extra layer of security"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:c?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Active"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Inactive"})]})})]}),c&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Setup Date:"}),e.jsx("div",{className:"font-medium",children:i.setupAt?.toLocaleDateString()||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Last Used:"}),e.jsx("div",{className:"font-medium",children:i.lastUsed?.toLocaleDateString()||"Never"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Backup Codes:"}),e.jsxs("div",{className:"font-medium",children:[i.remainingBackupCodes," remaining"]})]})]})}),e.jsx("div",{className:"flex gap-3",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[e.jsx(m,{className:"w-4 h-4"}),"Regenerate Backup Codes"]}),e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 border border-red-300 text-red-600 px-4 py-2 rounded hover:bg-red-50",children:[e.jsx(x,{className:"w-4 h-4"}),"Disable 2FA"]})]}):e.jsx("button",{onClick:()=>k(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Enable 2FA"})}),C&&e.jsx("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:C})]})})]}),F&&e.jsxs("div",{className:"bg-white border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Disable Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-red-700",children:"This will reduce your account security. Are you sure?"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter 2FA Code to Confirm"}),e.jsx("input",{type:"text",value:T,onChange:e=>D(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500",maxLength:6})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:async()=>{if(!T.trim())return;await j(t,T.trim())&&(A(!1),D(""))},disabled:N||6!==T.length,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50",children:N?"Disabling...":"Disable 2FA"}),e.jsx("button",{onClick:()=>{A(!1),D("")},className:"border border-gray-300 px-4 py-2 rounded hover:bg-gray-50",children:"Cancel"})]})]})]}),R&&e.jsxs("div",{className:"bg-white border border-blue-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Regenerate Backup Codes"}),e.jsx("p",{className:"text-sm text-blue-700",children:"This will invalidate your current backup codes and create new ones."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter 2FA Code to Confirm"}),e.jsx("input",{type:"text",value:E,onChange:e=>U(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:6})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:async()=>{if(!E.trim())return;const e=await y(t,E.trim());e.length>0&&(L(e),B(!1),U(""),_(!0))},disabled:N||6!==E.length,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:N?"Regenerating...":"Regenerate Codes"}),e.jsx("button",{onClick:()=>{B(!1),U("")},className:"border border-gray-300 px-4 py-2 rounded hover:bg-gray-50",children:"Cancel"})]})]})]}),M&&V.length>0&&e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(d,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"New Backup Codes Generated"}),e.jsx("p",{className:"text-sm text-green-700",children:"Save these codes in a secure location. They can only be viewed once."})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:V.map((s,t)=>e.jsx("code",{className:"bg-white border rounded px-2 py-1 text-sm font-mono",children:s},t))})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{const e=V.join("\n"),s=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="2fa-backup-codes-new.txt",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[e.jsx(l,{className:"w-4 h-4"}),"Download"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(V.join("\n"))},className:"flex items-center gap-2 border border-gray-300 px-4 py-2 rounded hover:bg-gray-50",children:[e.jsx(h,{className:"w-4 h-4"}),"Copy"]}),e.jsx("button",{onClick:()=>{_(!1),L([])},className:"border border-gray-300 px-4 py-2 rounded hover:bg-gray-50",children:"Done"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(g,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Security Activity"})]}),e.jsx("div",{className:"space-y-3",children:I.map(s=>e.jsx("div",{className:`border rounded-lg p-4 ${Q(s.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[O(s.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.description}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),s.timestamp.toLocaleString()]}),s.ipAddress&&e.jsxs("span",{children:["IP: ",s.ipAddress]}),s.location&&e.jsx("span",{children:s.location})]})})]})]})},s.id))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(r,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"Security Recommendations"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(d,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsx("span",{children:"Use a strong, unique password for your account"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(d,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsx("span",{children:"Enable two-factor authentication for enhanced security"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(d,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsx("span",{children:"Regularly review your security activity"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(d,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsx("span",{children:"Keep your backup codes in a secure location"})]})]})]})]})};function S(){const{user:r}=j(),{trackPageView:n,trackFeatureUsage:c}=t();return s.useEffect(()=>{n("/security/settings","Security Settings"),c("security_dashboard","view")},[n,c]),r?e.jsxs(e.Fragment,{children:[e.jsxs(a,{children:[e.jsx("title",{children:"Security Settings - NGO Management System"}),e.jsx("meta",{name:"description",content:"Manage your account security settings including two-factor authentication"})]}),e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(C,{userId:String(r.id||r.email),className:"max-w-4xl mx-auto"})})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to access security settings."})]})})}export{S as default};
